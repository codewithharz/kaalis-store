<template>
    <div>
        <div v-if="isLoading" class="flex justify-center items-center h-screen">
            <p class="text-xl">Loading...</p>
        </div>
        <div v-else-if="!isSeller">
            <UserProfileCard :user="user" :address="address" />
            <div class="mt-4 text-center">
                <p class="mb-2">You are not a seller yet. Would you like to become one?</p>
                <button @click="navigateToBecomeSeller"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Become a Seller
                </button>
            </div>
        </div>
        <div v-else class="bg-gray-100 min-h-screen">
            <div class="container mx-auto px-4 py-4 sm:py-8">
                <header class="bg-white shadow rounded-lg overflow-hidden mb-4 sm:mb-6">
                    <div class="relative bg-cover bg-center p-4 sm:p-6"
                        :style="{ backgroundImage: `url('${sellerProfile.backgroundImage || defaultBackgroundImage}')` }">
                        <div class="absolute inset-0 bg-black bg-opacity-50"></div>
                        <div class="relative flex flex-col space-y-4">
                            <div class="flex items-center text-white">
                                <img :src="sellerAvatar" alt="Seller Avatar"
                                    class="w-16 h-16 rounded-full border-2 border-white mr-4">
                                <div>
                                    <h1 class="text-xl sm:text-2xl font-bold">Seller Dashboard</h1>
                                    <p class="text-sm sm:text-base">Welcome, {{ sellerName }}</p>
                                </div>
                            </div>
                            <div
                                class="flex flex-col sm:flex-row justify-center sm:justify-end space-y-2 sm:space-y-0 sm:space-x-4 mt-4 sm:mt-0">
                                <button @click="showEditProfileModal = true"
                                    class="bg-indigo-600 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-indigo-700 transition duration-300">
                                    Edit Profile
                                </button>
                                <button @click="toggleVacationMode" :class="{
                                    'bg-yellow-500 hover:bg-yellow-600': sellerProfile.isVacationMode,
                                    'bg-green-500 hover:bg-green-600': !sellerProfile.isVacationMode
                                }"
                                    class="text-white px-4 py-2 rounded-full text-sm font-semibold transition duration-300">
                                    {{ sellerProfile.isVacationMode ? 'End Vacation' : 'Start Vacation' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Quick Stats -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-4 sm:mb-6">
                    <div v-for="stat in quickStats" :key="stat.label" class="bg-white rounded-lg shadow p-4 sm:p-6"
                        :class="{ 'col-span-1 sm:col-span-2': stat.label === 'Total Sales' }">
                        <div class="flex items-start">
                            <div
                                :class="`text-${stat.color}-500 rounded-full p-2 sm:p-3 bg-${stat.color}-100 mr-3 sm:mr-4 flex-shrink-0`">
                                <component :is="stat.icon" class="size-6 sm:size-7" />
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="text-xs sm:text-sm text-gray-700">{{ stat.label }}</p>
                                <p class="text-lg sm:text-xl  font-semibold break-words">{{ stat.value }}</p>
                                <p v-if="stat.label === 'Total Sales'" class="text-xs sm:text-sm text-gray-600 mt-1">
                                    {{ stat.valueInWords }}
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Revenue Overview card -->
                    <div class="bg-white rounded-lg shadow p-4 sm:p-6">
                        <div class="flex items-start">
                            <div class="text-blue-500 rounded-full p-2 sm:p-3 bg-blue-100 mr-3 sm:mr-4 flex-shrink-0">
                                <TrendingUp class="size-6 sm:size-7" />
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="text-xs sm:text-sm text-gray-600">Revenue Overview</p>
                                <p class="text-lg sm:text-xl  font-semibold break-words">
                                    {{ revenueOverview.growth }}%
                                    <span v-if="revenueOverview.growth == 0" class="text-xs font-normal">(No
                                        change)</span>
                                </p>
                                <p class="text-xs sm:text-sm text-gray-500 mt-1">
                                    {{ revenueOverview.comparisonPeriod }}
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Top Selling Products -->
                    <div class="bg-white rounded-lg shadow p-4 sm:p-6">
                        <div class="flex items-start">
                            <div
                                class="text-orange-500 rounded-full p-2 sm:p-3 bg-orange-100 mr-3 sm:mr-4 flex-shrink-0">
                                <Award class="size-6 sm:size-7" />
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="text-xs sm:text-sm text-gray-600">Top Selling Product</p>
                                <p class="text-lg sm:text-xl  font-semibold break-words"
                                    :title="topSellingProduct.name">
                                    {{ topSellingProduct.truncatedName }}{{ topSellingProduct.name.length > 20 ? '...' :
                                        '' }}
                                </p>
                                <p class="text-xs sm:text-sm text-gray-500 mt-1">
                                    {{ topSellingProduct.quantity > 0 ? `${topSellingProduct.quantity} units sold` :
                                        'No units sold yet' }}
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Orders -->
                    <div class="bg-white rounded-lg shadow p-4 sm:p-6">
                        <div class="flex items-start">
                            <div
                                class="text-yellow-500 rounded-full p-2 sm:p-3 bg-yellow-100 mr-3 sm:mr-4 flex-shrink-0">
                                <Clock class="size-6 sm:size-7" />
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="text-xs sm:text-sm text-gray-600">Pending Orders</p>
                                <p class="text-lg sm:text-xl  font-semibold break-words">
                                    {{ pendingOrders }}
                                </p>
                                <p class="text-xs sm:text-sm text-gray-500 mt-1">
                                    {{ pendingOrders === 1 ? 'Awaiting processing' : 'Awaiting processing' }}
                                </p>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Main Content -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
                    <!-- Recent Orders -->
                    <div class="lg:col-span-2 bg-white rounded-lg shadow">
                        <div class="p-4 sm:p-6 border-b border-gray-200">
                            <h2 class="text-lg sm:text-xl font-semibold">Recent Orders ({{ recentOrders.length }})</h2>
                        </div>
                        <div class="p-4 sm:p-6">
                            <div v-if="recentOrders.length > 0" class="space-y-4">
                                <div v-for="order in paginatedOrders" :key="order.id"
                                    class="flex flex-col border-b pb-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <div>
                                            <p class="font-semibold">#{{ order.orderNumber }}</p>
                                            <p class="text-xs sm:text-sm text-gray-600">{{ order.date }}</p>
                                        </div>
                                        <p :class="`text-xs sm:text-sm ${getStatusColor(order.status)}`">
                                            {{ order.status }}
                                        </p>
                                    </div>
                                    <div class="mb-2">
                                        <p class="text-sm">Customer: {{ order.customerName }}</p>
                                        <p class="text-sm">Items: {{ order.products.length }}</p>
                                    </div>
                                    <div class="text-sm">
                                        <p v-for="product in order.products" :key="product.name" class="mb-1">
                                            {{ product.name }} (x{{ product.quantity }}) - ₦{{ product.formattedSubtotal
                                            }}
                                        </p>
                                    </div>
                                    <p class="font-semibold text-right mt-2">Total: ₦{{ order.formattedTotal }}</p>
                                </div>
                            </div>
                            <p v-else class="text-gray-500 text-center">No recent orders</p>
                        </div>
                        <!-- Pagination controls -->
                        <div class="p-4 bg-gray-50 flex justify-between items-center">
                            <button @click="prevPage" :disabled="currentPage === 1"
                                class="text-indigo-600 hover:text-indigo-800 font-semibold disabled:text-gray-400">
                                Previous
                            </button>
                            <span>Page {{ currentPage }} of {{ totalPages }}</span>
                            <button @click="nextPage" :disabled="currentPage === totalPages"
                                class="text-indigo-600 hover:text-indigo-800 font-semibold disabled:text-gray-400">
                                Next
                            </button>
                        </div>
                        <div class="p-4 bg-gray-50 text-center">
                            <button @click="viewAllOrders"
                                class="text-indigo-600 hover:text-indigo-800 font-semibold">View All Orders</button>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-4 sm:p-6 border-b border-gray-200">
                            <h2 class="text-lg sm:text-xl font-semibold">Quick Actions</h2>
                        </div>
                        <div class="p-4 sm:p-6">
                            <div class="space-y-3 sm:space-y-4">
                                <button @click="addNewProduct"
                                    class="w-full flex justify-center items-center bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition duration-300">
                                    <CirclePlus class="size-5 mr-2" /> Add New Product
                                </button>
                                <button @click="showUpdateInventory = true"
                                    class="w-full flex justify-center items-center bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition duration-300">
                                    <Boxes class="size-5 mr-2" /> Update Inventory
                                </button>
                                <button @click="managePromotions"
                                    class="w-full flex justify-center items-center bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 transition duration-300">
                                    <Tag class="size-5 mr-2" /> Manage Promotions
                                </button>
                                <button @click="viewAnalytics"
                                    class="w-full flex justify-center items-center bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition duration-300">
                                    <AlignEndHorizontal class=" mr-2" /> View Analytics
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Update Inventory Modal -->
                    <div v-show="showUpdateInventory"
                        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div class="bg-white rounded-lg w-full max-w-6xl max-h-screen overflow-auto">
                            <button @click="showUpdateInventory = false"
                                class="float-right m-2 text-gray-600 hover:text-gray-800">
                                <XIcon class="h-6 w-6" />
                            </button>
                            <UpdateInventory @close="showUpdateInventory = false" />
                        </div>
                    </div>
                </div>

                <!-- Performance Chart -->
                <div class="mt-4 sm:mt-6 bg-white rounded-lg shadow p-4 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-semibold mb-4">Sales Performance</h2>
                    <canvas ref="salesChart"></canvas>
                </div>
            </div>
        </div>

        <div v-if="showEditProfileModal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg w-full max-w-md">
                <EditSellerProfile @close="showEditProfileModal = false" @profile-updated="onProfileUpdated" />
            </div>
        </div>
    </div>
</template>


<script>
import UserProfileCard from './UserProfileCard.vue';
import UpdateInventory from './UpdateInventory.vue';
import EditSellerProfile from './EditSellerProfile.vue';
import { ref, onMounted, computed, watch } from 'vue';
import { useRouter } from 'vue-router';
import { useUserStore } from '../store/user';
import { useSellerStore } from '../store/sellerStore';
import { useAddressStore } from '../store/addressStore';
import { UserRound, CirclePlus, Boxes, Tag, AlignEndHorizontal, Banknote, ShoppingCart, Package, Users, XIcon, TrendingUp, Award, Clock } from 'lucide-vue-next';
import { toast } from 'vue-sonner';
import Chart from 'chart.js/auto';

export default {
    name: 'UserSellerDashboard',
    components: {
        UserProfileCard,
        UpdateInventory,
        EditSellerProfile,
        UserRound, CirclePlus, Boxes, Tag, AlignEndHorizontal, Banknote, ShoppingCart, Package, Users, XIcon, TrendingUp, Award, Clock
    },
    setup() {
        const router = useRouter();
        const userStore = useUserStore();
        const sellerStore = useSellerStore();
        const addressStore = useAddressStore();
        const salesChart = ref(null);
        const showUpdateInventory = ref(false);
        const recentOrders = ref([]);
        const showEditProfileModal = ref(false);
        const isLoading = ref(true);

        const currentPage = ref(1);
        const ordersPerPage = 2;

        const user = computed(() => userStore.user);
        const addresses = computed(() => addressStore.addresses);
        const isSeller = computed(() => userStore.isSeller);
        const sellerProfile = computed(() => sellerStore.sellerProfile || {});
        const sellerName = computed(() => sellerProfile.value.storeName || user.value?.username);
        const sellerAvatar = computed(() => sellerProfile.value.profileImage || '../assets/images/Kyrian.png');

        const onProfileUpdated = async () => {
            await checkAuthAndLoadData();
        };

        const toggleVacationMode = async () => {
            try {
                await sellerStore.toggleVacationMode();
                const newStatus = sellerProfile.value.isVacationMode ? 'enabled' : 'disabled';
                const storeStatus = sellerProfile.value.isVacationMode ? 'closed' : 'opened';
                toast.success(`Vacation mode ${newStatus} and store ${storeStatus}`);
            } catch (error) {
                console.error('Error toggling vacation mode:', error);
                toast.error('Failed to toggle vacation mode. Please try again.');
            }
        };

        const toggleStoreOpen = async () => {
            try {
                await sellerStore.toggleStoreOpen();
                toast.success(`Store ${sellerProfile.value.storeOpen ? 'opened' : 'closed'}`);
            } catch (error) {
                console.error('Error toggling store open status:', error);
                toast.error('Failed to toggle store status. Please try again.');
            }
        };

        // Add this function to convert numbers to words
        function numberToWords(num) {
            if (num === 0) return "Zero Naira";

            // Round to the nearest whole number
            num = Math.round(num);

            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const scales = ['', 'Thousand', 'Million', 'Billion', 'Trillion'];

            function convertGroup(n) {
                let result = '';
                if (n >= 100) {
                    result += ones[Math.floor(n / 100)] + ' Hundred';
                    n %= 100;
                    if (n > 0) result += ' and ';
                }
                if (n >= 20) {
                    result += tens[Math.floor(n / 10)];
                    if (n % 10 > 0) result += '-' + ones[n % 10];
                } else if (n >= 10) {
                    result += teens[n - 10];
                } else if (n > 0) {
                    result += ones[n];
                }
                return result;
            }

            let result = '';
            let scaleIndex = 0;

            while (num > 0) {
                if (num % 1000 !== 0) {
                    let groupResult = convertGroup(num % 1000);
                    if (scaleIndex > 0) groupResult += ' ' + scales[scaleIndex];
                    if (result) groupResult += ', ' + result;
                    result = groupResult;
                }
                num = Math.floor(num / 1000);
                scaleIndex++;
            }

            return result + ' Naira';
        };

        const quickStats = ref([
            { label: 'Total Sales', value: '₦0', valueInWords: '', icon: Banknote, color: 'green' },
            { label: 'Orders', value: '0', icon: ShoppingCart, color: 'blue' },
            { label: 'Products', value: '0', icon: Package, color: 'yellow' },
            { label: 'Customers', value: '0', icon: Users, color: 'purple' },
        ]);

        const revenueOverview = ref({
            growth: 0,
            comparisonPeriod: 'vs last 30 days'
        });

        const topSellingProduct = ref({
            name: '',
            quantity: 0
        });
        const pendingOrders = ref(0);

        const paginatedOrders = computed(() => {
            const start = (currentPage.value - 1) * ordersPerPage;
            const end = start + ordersPerPage;
            return recentOrders.value.slice(start, end);
        });

        const totalPages = computed(() => Math.ceil(recentOrders.value.length / ordersPerPage));

        const nextPage = () => {
            if (currentPage.value < totalPages.value) {
                currentPage.value++;
            }
        };

        const prevPage = () => {
            if (currentPage.value > 1) {
                currentPage.value--;
            }
        };

        const checkAuthAndLoadData = async () => {
            isLoading.value = true;
            try {
                if (!userStore.checkTokenExpiration()) {
                    console.error('User is not logged in or token is invalid');
                    toast.error('Please log in to access the dashboard.');
                    router.push('/login');
                    return;
                }

                await userStore.getUserProfile(); // Add this line

                if (userStore.user && userStore.user.isSeller) {
                    await sellerStore.loadSellerProfile();
                    await loadDashboardData();
                }
            } catch (error) {
                console.error('Error in checkAuthAndLoadData:', error);
                toast.error('Failed to load dashboard. Please try again.');
            } finally {
                isLoading.value = false;
            }
        };

        const navigateToBecomeSeller = () => {
            router.push({ name: 'BecomeSeller' });
        };

        const loadDashboardData = async () => {
            try {
                console.log('Starting loadDashboardData');
                console.log('Current user:', userStore.user);
                console.log('Current seller ID:', userStore.user.sellerProfile);
                console.log('Is seller?', isSeller.value);
                console.log('Is sellerStore.isSellerProfileLoaded?', sellerStore.isSellerProfileLoaded);

                if (!sellerStore.isSellerProfileLoaded) {
                    console.log('Attempting to load seller profile');
                    // await sellerStore.loadSellerProfile(userStore.user.sellerProfile);
                    await sellerStore.loadSellerProfile();
                    console.log('After loading seller profile:', sellerStore.sellerProfile);
                }

                if (sellerStore.sellerProfile) {
                    console.log('Fetching dashboard data');
                    const dashboardData = await sellerStore.fetchDashboardData();
                    console.log('Dashboard data:', dashboardData);

                    updateQuickStats(dashboardData);
                    // recentOrders.value = dashboardData.recentOrders;
                    recentOrders.value = dashboardData.recentOrders || [];
                    console.log('Recent orders:', recentOrders.value);

                    // Use the pendingOrders value from the API response
                    // pendingOrders.value = dashboardData.pendingOrders;
                    pendingOrders.value = dashboardData.pendingOrders || 0;
                    console.log('Pending orders:', pendingOrders.value);

                    // Handle top selling product
                    console.log('Top selling product:', dashboardData.topSellingProduct);
                    // topSellingProduct.value = dashboardData.topSellingProduct;
                    topSellingProduct.value = dashboardData.topSellingProduct || { name: 'No products', quantity: 0 };

                    // Handle revenue overview
                    console.log('Revenue growth:', dashboardData.revenueGrowth);
                    updateRevenueOverview(dashboardData.revenueGrowth);

                    // Format recent orders
                    // recentOrders.value = dashboardData.recentOrders.map(order => ({
                    //     ...order,
                    //     formattedTotal: formatPrice(order.total),
                    //     products: order.products.map(product => ({
                    //         ...product,
                    //         formattedSubtotal: formatPrice(product.subtotal),
                    //         formattedUnitPrice: formatPrice(product.subtotal / product.quantity)
                    //     }))
                    // }));

                    recentOrders.value = (dashboardData.recentOrders || []).map(order => ({
                        ...order,
                        formattedTotal: formatPrice(order.total),
                        products: order.products.map(product => ({
                            ...product,
                            formattedSubtotal: formatPrice(product.subtotal),
                            formattedUnitPrice: formatPrice(product.subtotal / product.quantity)
                        }))
                    }));

                    // Log the values for debugging
                    console.log('Revenue Overview:', revenueOverview.value);
                    console.log('Top Selling Product:', topSellingProduct.value);
                    console.log('Pending Orders:', pendingOrders.value);
                    console.log('Recent Orders:', recentOrders.value);

                    // Initialize chart after a short delay
                    setTimeout(() => {
                        initSalesChart();
                    }, 100);
                } else {
                    console.log('User is not a seller');
                    toast.error('You do not have seller privileges.');
                }
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
                toast.error('Failed to load dashboard data. Please check your connection and try again.');
                if (error.response && error.response.status === 401) {
                    userStore.logoutUser();
                    router.push('/login');
                }
            }
        };

        const becomeSeller = async () => {
            try {
                await userStore.becomeSeller();
                toast.success('You are now a seller!');
                await checkAuthAndLoadData();
            } catch (error) {
                console.error('Failed to become a seller:', error);
                toast.error('Failed to become a seller. Please try again.');
            }
        };

        const formatPrice = (price) => {
            if (typeof price === 'string') {
                price = parseFloat(price);
            }
            if (typeof price !== 'number' || isNaN(price)) {
                console.log(`Invalid price value:`, price);
                return 'N/A';
            }
            return price.toLocaleString('en-NG', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };

        const formatNumber = (num) => {
            return num.toLocaleString('en-NG');
        };

        const updateQuickStats = (data) => {
            console.log('Raw total sales:', data.totalSales);
            const formattedSales = formatPrice(data.totalSales);
            console.log('Formatted total sales:', formattedSales);
            quickStats.value = [
                { label: 'Total Sales', value: `₦${formattedSales}`, valueInWords: numberToWords(Math.floor(data.totalSales)), icon: Banknote, color: 'green' },
                { label: 'Orders', value: formatNumber(data.totalOrders), icon: ShoppingCart, color: 'blue' },
                { label: 'Products', value: formatNumber(data.totalProducts), icon: Package, color: 'yellow' },
                { label: 'Customers', value: formatNumber(data.totalCustomers), icon: Users, color: 'purple' },
            ];
        };

        const updateRevenueOverview = (growthPercentage) => {
            revenueOverview.value = {
                growth: growthPercentage !== undefined ? Number(growthPercentage).toFixed(2) : '0.00',
                comparisonPeriod: 'vs last 30 days'
            };
        };

        const initSalesChart = () => {
            console.log('Entering initSalesChart');
            console.log('recentOrders.value:', recentOrders.value);
            console.log('salesChart.value:', salesChart.value);

            if (!recentOrders.value || recentOrders.value.length === 0 || !salesChart.value) {
                console.log('No recent orders available');
                return;
            }

            if (!salesChart.value) {
                console.log('Canvas element not available');
                return;
            }

            const ctx = salesChart.value.getContext('2d');
            console.log('Chart context:', ctx);

            const labels = recentOrders.value.map(order => order.date);
            const data = recentOrders.value.map(order => order.total);

            console.log('Chart labels:', labels);
            console.log('Chart data:', data);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Recent Sales',
                        data: data,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Order Total (₦)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Order Date'
                            }
                        }
                    }
                }
            });
            console.log('Chart initialized');
        };

        const getStatusColor = (status) => {
            const colors = {
                'Pending': 'text-yellow-600',
                'Shipped': 'text-blue-600',
                'Delivered': 'text-green-600',
                'Cancelled': 'text-red-600'
            };
            return colors[status] || 'text-gray-600';
        };

        const editProfile = () => {
            router.push({ name: 'EditSellerProfile', params: { id: user.value._id } });
        };

        const toggleStoreStatus = async () => {
            try {
                await sellerStore.toggleStoreStatus(user.value._id);
                toast.success(`Store is now ${sellerProfile.value.storeOpen ? 'open' : 'closed'}`);
            } catch (error) {
                toast.error('Failed to update store status');
            }
        };

        const viewAllOrders = () => router.push({ name: 'SellerOrders' });
        const addNewProduct = () => router.push({ name: 'AddProduct' });
        const managePromotions = () => router.push({ name: 'ManagePromotions' });
        const viewAnalytics = () => router.push({ name: 'SellerAnalytics' });

        const defaultProfileImage = '../assets/images/Kyrian.png';
        const defaultBackgroundImage = '../assets/images/Kyrian.png';

        // onMounted(checkAuthAndLoadData); //original
        onMounted(() => {
            checkAuthAndLoadData();
        });

        watch(() => router.currentRoute.value.path, (newPath, oldPath) => {
            if (newPath === '/account/profile/profile-user/' && oldPath !== newPath) {
                checkAuthAndLoadData();
            }
        });

        return {
            user,
            isSeller,
            isLoading,
            sellerProfile,
            sellerName,
            sellerAvatar,
            quickStats,
            recentOrders,
            salesChart,
            showUpdateInventory,
            paginatedOrders,
            currentPage,
            totalPages,
            nextPage,
            prevPage,
            formatPrice,
            formatNumber,
            getStatusColor,
            editProfile,
            toggleStoreStatus,
            viewAllOrders,
            addNewProduct,
            managePromotions,
            viewAnalytics,
            becomeSeller, //remove this later  it is just a test
            navigateToBecomeSeller,
            revenueOverview,
            topSellingProduct,
            pendingOrders,
            showEditProfileModal,
            onProfileUpdated,
            defaultProfileImage,
            defaultBackgroundImage,
            toggleVacationMode,
            toggleStoreOpen
        };
    }
};
</script>

<style scoped>
/* Add any additional styles here */
.custom-radio-container {
    display: flex;
    align-items: center;
    margin-top: 1rem;
}

.custom-radio-container input[type="radio"] {
    position: absolute;
    opacity: 0;
}

.custom-radio-container label {
    position: relative;
    padding-left: 2.4rem;
    cursor: pointer;
    font-size: 13px;
    color: #555;
}

.custom-radio-container label::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 50%;
    border: 2px solid #24a3b5;
    background-color: #fff;
    transition: background-color 0.3s, border-color 0.3s;
}

.custom-radio-container input[type="radio"]:checked+label::before {
    background-color: #24a3b5;
    border-color: #24a3b5;
}

.custom-radio-container input[type="radio"]:checked+label::after {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translate(50%, -50%);
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
    background-color: #fff;
}

.custom-border-animation {
    position: relative;
    border-bottom: 1px solid transparent;
    transition: border-color 1s ease;
}

.custom-border-animation:focus {
    outline: none;
    border-bottom: 1px solid #24a3b5;
}

.custom-border-animation:focus::before,
.custom-border-animation:focus::after {
    content: '';
    position: absolute;
    bottom: 0;
    height: 1px;
    width: 0;
    background: #24a3b5;
    transition: width 20s ease;
}

.custom-border-animation:focus::before {
    left: 50%;
}

.custom-border-animation:focus::after {
    right: 50%;
}

.custom-border-animation:focus:valid::before,
.custom-border-animation:focus:valid::after {
    width: 50%;
}

.custom-border-animation:focus:valid {
    border-bottom: 2px solid #24a3b5;
}
</style>