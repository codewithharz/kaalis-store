<template>
    <div class="flex flex-col items-center p-4 bg-gray-100">
        <!-- Header Section -->
        <!-- <div class="flex items-center justify-between w-11/12 mb-5">
            <h2 class="text-2xl font-bold">My Products</h2>
            <input type="file" @change="handleFileUpload" accept="image/*" ref="fileInput" />
            <button @click="uploadFile"
                class="button-hover shadow-md bg-gradient-to-r from-[#ff934b] to-[#ff5e62] hover:from-[#ff5e62] hover:to-[#ff934b] text-white px-4 py-2 rounded-md">
                Upload
            </button>
        </div> -->

        <!-- Carousel Section -->
        <div class="w-full max-w-6xl relative">
            <div class="flex overflow-hidden">
                <div class="flex transition-transform duration-300 ease-in-out"
                    :style="{ transform: `translateX(-${currentIndex * 25}%)` }">
                    <ProductCard v-for="product in userProducts" :key="product._id" :product="product"
                        :isUserProduct="true" @edit="handleEditProduct" @delete="handleDeleteProduct"
                        class="w-full sm:w-1/2 md:w-1/3 lg:w-1/4 flex-shrink-0 p-2" />
                </div>
            </div>
            <button @click="prevSlide"
                class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-white p-2 rounded-full shadow-lg"
                :disabled="currentIndex === 0">
                <span class="sr-only">Previous</span>
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <button @click="nextSlide"
                class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-white p-2 rounded-full shadow-lg"
                :disabled="currentIndex > Math.ceil(userProducts.length / 4)">
                <span class="sr-only">Next</span>
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </button>
        </div>

        <!-- Dots Navigation -->
        <div class="flex justify-center mt-4">
            <button v-for="(_, index) in Array(Math.ceil(userProducts.length / 4))" :key="index"
                @click="goToSlide(index)" class="mx-1 w-3 h-3 rounded-full"
                :class="currentIndex === index ? 'bg-[#24a3b5]' : 'bg-gray-300'"></button>
        </div>

        <!-- Edit Modal -->
        <EditWishlistProductModal :isEditModalOpen="isEditModalOpen" :editingProduct="editingProduct" :userId="userId"
            @update:isEditModalOpen="isEditModalOpen = $event" @product-updated="handleProductUpdated" />
    </div>
</template>

<script>
import EditWishlistProductModal from './EditWishlistProductModal.vue';
import { ref, onMounted } from 'vue';
import ProductCard from './ProductCard.vue';
import apiClient from '../api/axios';
import { useUserStore } from '../store/user';
import { storage } from '../utils/firebase.js';
import { ref as storageRef, uploadBytes, getDownloadURL } from 'firebase/storage';
import { toast } from 'vue-sonner';

export default {
    name: 'UserProducts',
    components: {
        ProductCard,
        EditWishlistProductModal
    },
    setup() {
        const userProducts = ref([]);
        const userStore = useUserStore();
        const userId = userStore.user._id; // Extract userId
        const currentIndex = ref(0);
        const fileToUpload = ref(null);
        const fileInput = ref(null);
        // Adding the reactive states for the edit modal
        const isEditModalOpen = ref(false);
        const editingProduct = ref({});

        const fetchUserProducts = async () => {
            try {
                const userId = userStore.user._id;
                const response = await apiClient.get(`/products/${userId}/products`);
                userProducts.value = response.data;
            } catch (error) {
                console.error('Error fetching user products:', error);
                toast.error('Failed to fetch products. Please try again.');
            }
        };

        const handleFileUpload = (event) => {
            fileToUpload.value = event.target.files[0];
        };

        const uploadFile = async () => {
            if (!fileToUpload.value) {
                toast.error('Please select a file to upload.');
                return;
            }

            try {
                const fileName = `${Date.now()}_${fileToUpload.value.name}`;
                const fileRef = storageRef(storage, `products/${fileName}`);

                await uploadBytes(fileRef, fileToUpload.value);
                const downloadURL = await getDownloadURL(fileRef);

                console.log('File uploaded successfully. Download URL:', downloadURL);
                toast.success('File uploaded successfully');

                await fetchUserProducts();

                fileToUpload.value = null;
                if (fileInput.value) {
                    fileInput.value.value = '';
                }
            } catch (error) {
                console.error('Error uploading file:', error);
                toast.error('Error uploading file. Please try again.');
            }
        };

        const nextSlide = () => {
            if (currentIndex.value < Math.ceil(userProducts.value.length / 4)) {
                currentIndex.value++;
            }
        };

        const prevSlide = () => {
            if (currentIndex.value > 0) {
                currentIndex.value--;
            }
        };

        const goToSlide = (index) => {
            currentIndex.value = index;
        };

        onMounted(() => {
            if (userStore.isLoggedIn) {
                fetchUserProducts();
            }
        });

        const showEditModal = (product) => {
            isEditModalOpen.value = true;
            editingProduct.value = { ...product }; // Create a copy of the product
            console.log('Editing product:', editingProduct.value);
        };

        const handleEditProduct = (productId) => {
            const productToEdit = userProducts.value.find(product => product._id === productId);
            console.log("Product to edit:", productToEdit);
            showEditModal(productToEdit);
        };

        const handleProductUpdated = (updatedProduct) => {
            const index = userProducts.value.findIndex(p => p._id === updatedProduct._id);
            if (index !== -1) {
                userProducts.value[index] = updatedProduct;
            }
            isEditModalOpen.value = false; // Close the modal after update
            toast.success('Product updated successfully');
        };


        const handleDeleteProduct = (productId) => {
            console.log('Deleting product:', productId);
            // Add delete logic here if necessary
        };

        onMounted(() => {
            if (userStore.isLoggedIn) {
                fetchUserProducts();
            }
        });

        return {
            userProducts,
            handleFileUpload,
            uploadFile,
            currentIndex,
            nextSlide,
            prevSlide,
            goToSlide,
            fileInput,
            isEditModalOpen,
            editingProduct,
            handleEditProduct,
            handleDeleteProduct,
            showEditModal,
            userId,
            handleProductUpdated
        };
    }
}
</script>

=====================================version-2================================
<template>
    <div class="container mx-auto p-4 bg-white my-user-products-page">
        <h1 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 page-title">My Products</h1>
        <div class="flex flex-col sm:flex-row justify-between mb-4 sm:mb-6">
            <input v-model="searchQuery" placeholder="Search products..."
                class="search-input p-2 border rounded mb-2 sm:mb-0 w-full sm:w-auto" />
            <div class="hidden sm:block view-toggle flex justify-center sm:justify-end">
                <button @click="viewMode = 'grid'" :class="{ 'bg-blue-500 text-white': viewMode === 'grid' }"
                    class="px-3 sm:px-4 py-2 border rounded text-sm sm:text-base">Grid</button>
                <button @click="viewMode = 'list'" :class="{ 'bg-blue-500 text-white': viewMode === 'list' }"
                    class="px-3 sm:px-4 py-2 border rounded text-sm sm:text-base ml-2">List</button>
            </div>
        </div>
        <div v-if="loading" class="text-center py-8">Loading...</div>
        <div v-else-if="error" class="text-center py-8 text-red-500">{{ error }}</div>
        <transition-group :name="viewMode" tag="div" class="grid gap-4 text-sm sm:gap-6"
            :class="{ 'grid-cols-1': viewMode === 'list', 'sm:grid-cols-2 lg:grid-cols-4': viewMode === 'grid' }">
            <div v-for="product in filteredProducts" :key="product._id"
                class="product-card bg-gray-50 border rounded-lg shadow-md">
                <div
                    :class="{ 'flex flex-col h-full': viewMode === 'grid', 'flex flex-col sm:flex-row h-full': viewMode === 'list' }">
                    <div
                        :class="{ 'w-full mb-3 sm:mb-4': viewMode === 'grid', 'sm:w-1/3 lg:w-1/4 sm:mr-4 mb-3 sm:mb-0': viewMode === 'list' }">
                        <img :src="product.images[0]" :alt="product.name"
                            class="w-full h-72 object-cover rounded-t-lg cursor-pointer"
                            @click="navigateToProductDetails(product._id)" />
                    </div>
                    <div class="px-4 flex-grow flex flex-col justify-between" :class="{ 'p-4': viewMode === 'list' }">
                        <div>
                            <div class="pb-3 space-x-1">
                                <!-- <span class="font-medium cursor-pointer">{{ product.name }}</span>
                                <span class="text-[#363636]">{{ product.description }}</span> -->
                                <span class="font-medium cursor-pointer" :title="product.name"
                                    @click="navigateToProductDetails(product._id)">
                                    {{ formatTitle(product.name) }}
                                </span>
                                <p class="text-[#363636]">
                                    <span v-html="formatDescription(product)" className='text-gray-600'></span>
                                    <span v-if="product.description.length > 100" @click="toggleDescription(product)"
                                        class="text-blue-500 cursor-pointer">
                                        {{ product.showFullDescription ? 'Read less' : 'Read more' }}
                                    </span>
                                </p>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <p class="text-[#f47a24] text-[13px] font-semibold">₦ {{ product.price.toFixed(2) }}</p>
                                <p class="text-gray-500 line-through">₦ {{ calculateOriginalPrice(product) }}</p>
                            </div>
                            <p class="text-[#f47a24] mb-2">{{ product.discount }}% off</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between gap-2 p-2" :class="{ 'p-4': viewMode === 'list' }">
                        <button @click="handleEditProduct(product._id)"
                            class="w-fit text-violet-500 py-1 px-3 rounded-lg hover:text-violet-600 transition duration-300 text-sm sm:text-base">
                            Edit
                        </button>
                        <AlertDialog>
                            <AlertDialogTrigger as-child>
                                <button
                                    class="w-fit text-red-500 py-1 px-3 rounded-lg hover:text-red-600 transition duration-300 text-sm sm:text-base">
                                    Delete
                                </button>
                            </AlertDialogTrigger>
                            <AlertDialogContent>
                                <AlertDialogHeader>
                                    <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>
                                    <AlertDialogDescription>
                                        This action cannot be undone. This will permanently delete your
                                        account and remove your data from our servers.
                                    </AlertDialogDescription>
                                </AlertDialogHeader>
                                <AlertDialogFooter>
                                    <AlertDialogCancel>Cancel</AlertDialogCancel>
                                    <AlertDialogAction>
                                        <button @click="handleDeleteProduct(product._id)">
                                            Delete
                                        </button>
                                    </AlertDialogAction>
                                </AlertDialogFooter>
                            </AlertDialogContent>
                        </AlertDialog>
                    </div>
                </div>
            </div>
        </transition-group>
        <div v-if="userProducts.length === 0" class="empty-state text-center py-8">
            <h2 class="text-xl sm:text-2xl font-semibold mb-3 sm:mb-4">You have no products!</h2>
            <p class="text-gray-600 mb-3 sm:mb-4 text-sm sm:text-base">Start adding products to your inventory.</p>
            <button @click="createNewProduct"
                class="create-btn bg-blue-500 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-blue-600 transition duration-300 text-sm sm:text-base">
                Add New Product
            </button>
        </div>
        <!-- <EditWishlistProductModal :isEditModalOpen="isEditModalOpen" :editingProduct="editingProduct" :userId="userId"
            @update:isEditModalOpen="isEditModalOpen = $event" @product-updated="handleProductUpdated" /> -->

        <EditWishlistProductModal v-if="isEditModalOpen && localEditingProduct" :isEditModalOpen="isEditModalOpen"
            :localEditingProduct="localEditingProduct" :userId="userId"
            @update:isEditModalOpen="isEditModalOpen = $event" @product-updated="handleProductUpdated" />
    </div>
</template>

<script>
import EditWishlistProductModal from './EditWishlistProductModal.vue';
import { ref, computed, onMounted, watch } from 'vue';
import apiClient from '../api/axios';
import { useProductStore } from '../store/productStore.js';
import { useUserStore } from '../store/user';
import { storage } from '../utils/firebase.js';
import { ref as storageRef, uploadBytes, getDownloadURL } from 'firebase/storage';
import { toast } from 'vue-sonner';
import { useRouter } from 'vue-router';

import {
    AlertDialog,
    AlertDialogAction,
    AlertDialogCancel,
    AlertDialogContent,
    AlertDialogDescription,
    AlertDialogFooter,
    AlertDialogHeader,
    AlertDialogTitle,
    AlertDialogTrigger,
} from '@/components/ui/alert-dialog'

export default {
    name: 'UserProducts',
    components: {
        EditWishlistProductModal,

        AlertDialog,
        AlertDialogAction,
        AlertDialogCancel,
        AlertDialogContent,
        AlertDialogDescription,
        AlertDialogFooter,
        AlertDialogHeader,
        AlertDialogTitle,
        AlertDialogTrigger,
    },
    setup() {
        const router = useRouter();
        const userProducts = ref([]);
        const userStore = useUserStore();
        const productStore = useProductStore();
        const userId = userStore.user._id;
        const fileToUpload = ref(null);
        const fileInput = ref(null);
        const isEditModalOpen = ref(false);
        const localEditingProduct = ref(null);
        const loading = ref(true);
        const error = ref(null);
        const searchQuery = ref('');
        const viewMode = ref('grid');

        const navigateToProductDetails = (productId) => {
            router.push({ name: 'ProductDetails', params: { id: productId } });
        };

        const truncateDescription = (description) => {
            if (description.length <= 100) return description;
            return description.slice(0, 100) + '...';
        };

        const formatTitle = (title) => {
            // Capitalize the first letter of each word
            const capitalizedTitle = title.split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                .join(' ');

            if (capitalizedTitle.length <= 50) {
                return capitalizedTitle;
            } else {
                return capitalizedTitle.slice(0, 47) + '...';
            }
        };

        const formatDescription = (product) => {
            let description = product.description.toLowerCase();
            description = description.replace(/(^\s*\w|[.!?]\s*\w)/g, c => c.toUpperCase());

            if (product.showFullDescription || description.length <= 100) {
                return description;
            } else {
                return description.slice(0, 100) + '...';
            }
        };

        const toggleDescription = (product) => {
            product.showFullDescription = !product.showFullDescription;
        };

        const fetchUserProducts = async () => {
            try {
                loading.value = true;
                error.value = null;
                const response = await apiClient.get(`/products/${userId}/products`);
                // userProducts.value = response.data;
                userProducts.value = response.data.map(product => ({
                    ...product,
                    showFullDescription: false
                }));
            } catch (err) {
                console.error('Error fetching user products:', err);
                error.value = 'Failed to load products. Please try again.';
                toast.error(error.value);
            } finally {
                loading.value = false;
            }
        };

        const handleFileUpload = (event) => {
            fileToUpload.value = event.target.files[0];
        };

        const uploadFile = async () => {
            if (!fileToUpload.value) {
                toast.error('Please select a file to upload.');
                return;
            }

            try {
                const fileName = `${Date.now()}_${fileToUpload.value.name}`;
                const fileRef = storageRef(storage, `products/${fileName}`);

                await uploadBytes(fileRef, fileToUpload.value);
                const downloadURL = await getDownloadURL(fileRef);

                console.log('File uploaded successfully. Download URL:', downloadURL);
                toast.success('File uploaded successfully');

                await fetchUserProducts();

                fileToUpload.value = null;
                if (fileInput.value) {
                    fileInput.value.value = '';
                }
            } catch (error) {
                console.error('Error uploading file:', error);
                toast.error('Error uploading file. Please try again.');
            }
        };

        const showEditModal = (product) => {
            localEditingProduct.value = JSON.parse(JSON.stringify(product)); // Deep clone the product
            isEditModalOpen.value = true;
            console.log('Editing product:', localEditingProduct.value);
        };

        const handleEditProduct = (productId) => {
            const productToEdit = userProducts.value.find(product => product._id === productId);
            if (productToEdit) {
                showEditModal(productToEdit);
            } else {
                console.error('Product not found:', productId);
                toast.error('Error: Product not found');
            }
        };

        const handleProductUpdated = async (updatedProduct) => {
            try {
                const result = await productStore.updateProduct(updatedProduct._id, updatedProduct);
                const index = userProducts.value.findIndex(p => p._id === result._id);
                if (index !== -1) {
                    userProducts.value[index] = result;
                }
                isEditModalOpen.value = false;
                localEditingProduct.value = null; // Reset localEditingProduct after closing the modal
                toast.success('Product updated successfully');
            } catch (error) {
                console.error('Error updating product:', error);
                toast.error('Failed to update product');
            }
        };

        const handleDeleteProduct = async (productId) => {
            console.log('Deleting product:', productId);
            // Add delete logic here if necessary
            try {
                await productStore.deleteProduct(productId);
                userProducts.value = userProducts.value.filter(product => product._id !== productId);
                toast.success('Product deleted successfully');
            } catch (error) {
                console.error('Error deleting product:', error);
                toast.error('Failed to delete product. Please try again.');
            }
        };

        const calculateOriginalPrice = (product) => {
            return product.originalPrice || (product.discount ? Math.round(product.price / (1 - product.discount / 100)) : product.price);
        };

        const filteredProducts = computed(() => {
            return userProducts.value.filter(product =>
                product.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                product.description.toLowerCase().includes(searchQuery.value.toLowerCase())
            );
        });

        const createNewProduct = () => {
            router.push('/account/profile/add-product');
        };

        onMounted(() => {
            if (userStore.isLoggedIn) {
                fetchUserProducts();
            }
        });

        watch(isEditModalOpen, (newValue) => {
            if (!newValue) {
                localEditingProduct.value = null;
            }
        });

        return {
            userProducts,
            handleFileUpload,
            uploadFile,
            fileInput,
            isEditModalOpen,
            localEditingProduct,
            handleEditProduct,
            handleDeleteProduct,
            showEditModal,
            userId,
            handleProductUpdated,
            loading,
            error,
            searchQuery,
            viewMode,
            filteredProducts,
            calculateOriginalPrice,
            createNewProduct,
            formatTitle,
            formatDescription,
            truncateDescription,
            toggleDescription,
            navigateToProductDetails,
        };
    }
}
</script>


<style scoped>
.my-user-products-page {
    min-height: calc(100vh - 64px);
    /* Adjust based on your header height */
}

/* Transitions */
.grid-enter-active,
.grid-leave-active,
.list-enter-active,
.list-leave-active {
    transition: all 0.5s ease;
}

.grid-enter-from,
.grid-leave-to,
.list-enter-from,
.list-leave-to {
    opacity: 0;
    transform: translateY(30px);
}
</style>



=====================================version-3================================
<template>
    <div class="container mx-auto p-4 bg-white my-user-products-page">
        <h1 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 page-title">My Products</h1>
        <div class="flex flex-col sm:flex-row justify-between mb-4 sm:mb-6">
            <input v-model="searchQuery" placeholder="Search products..."
                class="search-input p-2 border rounded mb-2 sm:mb-0 w-full sm:w-auto" />
            <div class="hidden sm:block view-toggle flex justify-center sm:justify-end">
                <button @click="viewMode = 'grid'" :class="{ 'bg-blue-500 text-white': viewMode === 'grid' }"
                    class="px-3 sm:px-4 py-2 border rounded text-sm sm:text-base">Grid</button>
                <button @click="viewMode = 'list'" :class="{ 'bg-blue-500 text-white': viewMode === 'list' }"
                    class="px-3 sm:px-4 py-2 border rounded text-sm sm:text-base ml-2">List</button>
            </div>
        </div>
        <div v-if="loading" class="text-center py-8">Loading...</div>
        <div v-else-if="error" class="text-center py-8 text-red-500">{{ error }}</div>
        <transition-group :name="viewMode" tag="div" class="grid gap-4 text-sm sm:gap-6"
            :class="{ 'grid-cols-1': viewMode === 'list', 'sm:grid-cols-2 lg:grid-cols-4': viewMode === 'grid' }">
            <div v-for="product in filteredProducts" :key="product._id"
                class="product-card bg-gray-50 border rounded-lg shadow-md">
                <div
                    :class="{ 'flex flex-col h-full': viewMode === 'grid', 'flex flex-col sm:flex-row h-full': viewMode === 'list' }">
                    <div
                        :class="{ 'w-full mb-3 sm:mb-4': viewMode === 'grid', 'sm:w-1/3 lg:w-1/4 sm:mr-4 mb-3 sm:mb-0': viewMode === 'list' }">
                        <img :src="product.images[0]" :alt="product.name"
                            class="w-full h-72 object-cover rounded-t-lg cursor-pointer"
                            @click="navigateToProductDetails(product._id)" />
                    </div>
                    <div class="px-4 flex-grow flex flex-col justify-between" :class="{ 'p-4': viewMode === 'list' }">
                        <div>
                            <div class="pb-3 space-x-1">
                                <!-- <span class="font-medium cursor-pointer">{{ product.name }}</span>
                                <span class="text-[#363636]">{{ product.description }}</span> -->
                                <span class="font-medium cursor-pointer" :title="product.name"
                                    @click="navigateToProductDetails(product._id)">
                                    {{ formatTitle(product.name) }}
                                </span>
                                <p class="text-[#363636]">
                                    <span v-html="formatDescription(product)" className='text-gray-600'></span>
                                    <span v-if="product.description.length > 100" @click="toggleDescription(product)"
                                        class="text-blue-500 cursor-pointer">
                                        {{ product.showFullDescription ? 'Read less' : 'Read more' }}
                                    </span>
                                </p>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <p class="text-[#f47a24] text-[13px] font-semibold">₦ {{ product.price.toFixed(2) }}</p>
                                <p class="text-gray-500 line-through">₦ {{ calculateOriginalPrice(product) }}</p>
                            </div>
                            <p class="text-[#f47a24] mb-2">{{ product.discount }}% off</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between gap-2 p-2" :class="{ 'p-4': viewMode === 'list' }">
                        <button @click="handleEditProduct(product._id)"
                            class="w-fit text-violet-500 py-1 px-3 rounded-lg hover:text-violet-600 transition duration-300 text-sm sm:text-base">
                            Edit
                        </button>
                        <AlertDialog>
                            <AlertDialogTrigger as-child>
                                <button
                                    class="w-fit text-red-500 py-1 px-3 rounded-lg hover:text-red-600 transition duration-300 text-sm sm:text-base">
                                    Delete
                                </button>
                            </AlertDialogTrigger>
                            <AlertDialogContent>
                                <AlertDialogHeader>
                                    <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>
                                    <AlertDialogDescription>
                                        This action cannot be undone. This will permanently delete your
                                        account and remove your data from our servers.
                                    </AlertDialogDescription>
                                </AlertDialogHeader>
                                <AlertDialogFooter>
                                    <AlertDialogCancel>Cancel</AlertDialogCancel>
                                    <AlertDialogAction>
                                        <button @click="handleDeleteProduct(product._id)">
                                            Delete
                                        </button>
                                    </AlertDialogAction>
                                </AlertDialogFooter>
                            </AlertDialogContent>
                        </AlertDialog>
                    </div>
                </div>
            </div>
        </transition-group>
        <div v-if="userProducts.length === 0" class="empty-state text-center py-8">
            <h2 class="text-xl sm:text-2xl font-semibold mb-3 sm:mb-4">You have no products!</h2>
            <p class="text-gray-600 mb-3 sm:mb-4 text-sm sm:text-base">Start adding products to your inventory.</p>
            <button @click="createNewProduct"
                class="create-btn bg-blue-500 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-blue-600 transition duration-300 text-sm sm:text-base">
                Add New Product
            </button>
        </div>
        <!-- <EditWishlistProductModal :isEditModalOpen="isEditModalOpen" :editingProduct="editingProduct" :userId="userId"
            @update:isEditModalOpen="isEditModalOpen = $event" @product-updated="handleProductUpdated" /> -->

        <EditWishlistProductModal v-if="isEditModalOpen && localEditingProduct" :isEditModalOpen="isEditModalOpen"
            :localEditingProduct="localEditingProduct" :userId="userId"
            @update:isEditModalOpen="isEditModalOpen = $event" @product-updated="handleProductUpdated" />
    </div>
</template>

<script>
import EditWishlistProductModal from './EditWishlistProductModal.vue';
import { ref, computed, onMounted, watch } from 'vue';
import apiClient from '../api/axios';
import { useProductStore } from '../store/productStore.js';
import { useUserStore } from '../store/user';
import { storage } from '../utils/firebase.js';
import { ref as storageRef, uploadBytes, getDownloadURL } from 'firebase/storage';
import { toast } from 'vue-sonner';
import { useRouter } from 'vue-router';

import {
    AlertDialog,
    AlertDialogAction,
    AlertDialogCancel,
    AlertDialogContent,
    AlertDialogDescription,
    AlertDialogFooter,
    AlertDialogHeader,
    AlertDialogTitle,
    AlertDialogTrigger,
} from '@/components/ui/alert-dialog'

export default {
    name: 'UserProducts',
    components: {
        EditWishlistProductModal,

        AlertDialog,
        AlertDialogAction,
        AlertDialogCancel,
        AlertDialogContent,
        AlertDialogDescription,
        AlertDialogFooter,
        AlertDialogHeader,
        AlertDialogTitle,
        AlertDialogTrigger,
    },
    setup() {
        const router = useRouter();
        const userProducts = ref([]);
        const userStore = useUserStore();
        const productStore = useProductStore();
        const userId = userStore.user._id;
        const fileToUpload = ref(null);
        const fileInput = ref(null);
        const isEditModalOpen = ref(false);
        const localEditingProduct = ref(null);
        const loading = ref(true);
        const error = ref(null);
        const searchQuery = ref('');
        const viewMode = ref('grid');

        const navigateToProductDetails = (productId) => {
            router.push({ name: 'ProductDetails', params: { id: productId } });
        };

        const truncateDescription = (description) => {
            if (description.length <= 100) return description;
            return description.slice(0, 100) + '...';
        };

        const formatTitle = (title) => {
            // Capitalize the first letter of each word
            const capitalizedTitle = title.split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                .join(' ');

            if (capitalizedTitle.length <= 50) {
                return capitalizedTitle;
            } else {
                return capitalizedTitle.slice(0, 47) + '...';
            }
        };

        const formatDescription = (product) => {
            let description = product.description.toLowerCase();
            description = description.replace(/(^\s*\w|[.!?]\s*\w)/g, c => c.toUpperCase());

            if (product.showFullDescription || description.length <= 100) {
                return description;
            } else {
                return description.slice(0, 100) + '...';
            }
        };

        const toggleDescription = (product) => {
            product.showFullDescription = !product.showFullDescription;
        };

        const fetchUserProducts = async () => {
            try {
                loading.value = true;
                error.value = null;
                const response = await apiClient.get(`/products/${userId}/products`);
                // userProducts.value = response.data;
                userProducts.value = response.data.map(product => ({
                    ...product,
                    showFullDescription: false
                }));
            } catch (err) {
                console.error('Error fetching user products:', err);
                error.value = 'Failed to load products. Please try again.';
                toast.error(error.value);
            } finally {
                loading.value = false;
            }
        };

        const handleFileUpload = (event) => {
            fileToUpload.value = event.target.files[0];
        };

        const uploadFile = async () => {
            if (!fileToUpload.value) {
                toast.error('Please select a file to upload.');
                return;
            }

            try {
                const fileName = `${Date.now()}_${fileToUpload.value.name}`;
                const fileRef = storageRef(storage, `products/${fileName}`);

                await uploadBytes(fileRef, fileToUpload.value);
                const downloadURL = await getDownloadURL(fileRef);

                console.log('File uploaded successfully. Download URL:', downloadURL);
                toast.success('File uploaded successfully');

                await fetchUserProducts();

                fileToUpload.value = null;
                if (fileInput.value) {
                    fileInput.value.value = '';
                }
            } catch (error) {
                console.error('Error uploading file:', error);
                toast.error('Error uploading file. Please try again.');
            }
        };

        const showEditModal = (product) => {
            localEditingProduct.value = JSON.parse(JSON.stringify(product)); // Deep clone the product
            isEditModalOpen.value = true;
            console.log('Editing product:', localEditingProduct.value);
        };

        const handleEditProduct = (productId) => {
            const productToEdit = userProducts.value.find(product => product._id === productId);
            if (productToEdit) {
                showEditModal(productToEdit);
            } else {
                console.error('Product not found:', productId);
                toast.error('Error: Product not found');
            }
        };

        const handleProductUpdated = async (updatedProduct) => {
            console.log("Received updated product:", JSON.stringify(updatedProduct, null, 2));

            if (!updatedProduct._id) {
                console.error('Product ID is undefined');
                toast.error('Unable to update product: Missing ID');
                return;
            }

            try {
                // Ensure unit.base is a string
                if (updatedProduct.unit && updatedProduct.unit.base) {
                    updatedProduct.unit.base = String(updatedProduct.unit.base);
                }

                console.log('Updating product:', JSON.stringify(updatedProduct, null, 2));

                const result = await productStore.updateProduct(updatedProduct._id, updatedProduct);
                const index = userProducts.value.findIndex(p => p._id === result._id);
                if (index !== -1) {
                    userProducts.value[index] = result;
                } else {
                    userProducts.value.push(result);
                }

                isEditModalOpen.value = false;
                localEditingProduct.value = null; // Reset localEditingProduct after closing the modal
                toast.success('Product updated successfully');
            } catch (error) {
                console.error('Error updating product:', error);
                toast.error('Failed to update product');
            }
        };

        const handleDeleteProduct = async (productId) => {
            console.log('Deleting product:', productId);
            // Add delete logic here if necessary
            try {
                await productStore.deleteProduct(productId);
                userProducts.value = userProducts.value.filter(product => product._id !== productId);
                toast.success('Product deleted successfully');
            } catch (error) {
                console.error('Error deleting product:', error);
                toast.error('Failed to delete product. Please try again.');
            }
        };

        const calculateOriginalPrice = (product) => {
            return product.originalPrice || (product.discount ? Math.round(product.price / (1 - product.discount / 100)) : product.price);
        };

        const filteredProducts = computed(() => {
            return userProducts.value.filter(product =>
                product.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                product.description.toLowerCase().includes(searchQuery.value.toLowerCase())
            );
        });

        const createNewProduct = () => {
            router.push('/account/profile/add-product');
        };

        onMounted(() => {
            if (userStore.isLoggedIn) {
                fetchUserProducts();
            }
        });

        watch(isEditModalOpen, (newValue) => {
            if (!newValue) {
                localEditingProduct.value = null;
            }
        });

        return {
            userProducts,
            handleFileUpload,
            uploadFile,
            fileInput,
            isEditModalOpen,
            localEditingProduct,
            handleEditProduct,
            handleDeleteProduct,
            showEditModal,
            userId,
            handleProductUpdated,
            loading,
            error,
            searchQuery,
            viewMode,
            filteredProducts,
            calculateOriginalPrice,
            createNewProduct,
            formatTitle,
            formatDescription,
            truncateDescription,
            toggleDescription,
            navigateToProductDetails,
        };
    }
}
</script>


<style scoped>
.my-user-products-page {
    min-height: calc(100vh - 64px);
    /* Adjust based on your header height */
}

/* Transitions */
.grid-enter-active,
.grid-leave-active,
.list-enter-active,
.list-leave-active {
    transition: all 0.5s ease;
}

.grid-enter-from,
.grid-leave-to,
.list-enter-from,
.list-leave-to {
    opacity: 0;
    transform: translateY(30px);
}
</style>



========================================== version-4 ================================

<template>
    <div class="min-h-screen bg-gradient-to-b from-gray-50 to-white">
        <!-- Modern Hero Header -->
        <div class="relative text-white overflow-hidden bg-gradient-to-r from-violet-600 to-indigo-600">
            <!-- Decorative Elements -->
            <div class="absolute inset-0">
                <div class="absolute inset-0 bg-black/10"></div>
                <div class="absolute -left-32 -top-32 w-96 h-96 bg-white/20 rounded-full blur-3xl"></div>
                <div class="absolute -right-32 -bottom-32 w-96 h-96 bg-white/20 rounded-full blur-3xl"></div>
            </div>

            <div class="container mx-auto px-4 py-16 relative">
                <div class="max-w-3xl mx-auto text-center">
                    <h1 class="text-4xl font-bold mb-4">My Products</h1>
                    <p class="text-lg mb-8 text-white/90">Manage and organize your product listings</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mx-auto px-4 -mt-20 relative z-10">
            <div class="max-w-7xl mx-auto space-y-6">
                <!-- Main Card -->
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                    <div class="p-6">
                        <!-- Search and View Controls -->
                        <div class="flex flex-col sm:flex-row justify-between gap-4 mb-6">
                            <!-- Search Bar -->
                            <div class="relative">
                                <div
                                    class="relative rounded-lg border border-gray-200 focus-within:border-indigo-500 focus-within:ring-2 focus-within:ring-indigo-500/20 transition-all">
                                    <Search class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                                    <input v-model="searchQuery" placeholder="Search products..."
                                        class="w-full sm:w-64 pl-11 pr-4 py-2.5 text-gray-700 bg-transparent border-none focus:outline-none" />
                                </div>
                            </div>

                            <!-- View Controls -->
                            <div class="flex items-center gap-2">
                                <button @click="viewMode = 'grid'" :class="[
                                    'px-4 py-2 rounded-lg font-medium transition-all',
                                    viewMode === 'grid'
                                        ? 'bg-indigo-50 text-indigo-600'
                                        : 'text-gray-500 hover:bg-gray-50'
                                ]">
                                    Grid
                                </button>
                                <button @click="viewMode = 'list'" :class="[
                                    'px-4 py-2 rounded-lg font-medium transition-all',
                                    viewMode === 'list'
                                        ? 'bg-indigo-50 text-indigo-600'
                                        : 'text-gray-500 hover:bg-gray-50'
                                ]">
                                    List
                                </button>
                                <button @click="createNewProduct"
                                    class="ml-4 px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white rounded-lg font-medium shadow-lg transition-all duration-300 flex items-center gap-2">
                                    <PlusCircle class="w-5 h-5" />
                                    <span>Add Product</span>
                                </button>
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div v-if="loading" class="flex items-center justify-center py-12">
                            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"></div>
                        </div>

                        <!-- Error State -->
                        <div v-else-if="error" class="bg-red-50 text-red-600 rounded-xl p-4 flex items-center gap-3">
                            <AlertCircle class="w-5 h-5 flex-shrink-0" />
                            <p>{{ error }}</p>
                        </div>

                        <!-- Products Grid/List -->
                        <transition-group :name="viewMode" tag="div" class="grid gap-6" :class="{
                            'grid-cols-1': viewMode === 'list',
                            'sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4': viewMode === 'grid'
                        }">
                            <ProductCard v-for="product in filteredProducts" :key="product._id" :product="product"
                                :isUserProduct="true" @edit="handleEditProduct" @delete="handleDeleteProduct"
                                :custom-class="[
                                    'product-card bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-all duration-300',
                                    viewMode === 'list' ? 'sm:flex' : ''
                                ]" :view-mode="viewMode" />
                        </transition-group>

                        <!-- Add pagination controls here ⬇️ -->
                        <div v-if="!loading && filteredProducts.length > 0" class="mt-6 flex justify-center">
                            <nav class="flex items-center gap-2">
                                <button @click="changePage(currentPage - 1)" :disabled="currentPage === 1"
                                    class="px-3 py-2 rounded-lg border font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
                                    Previous
                                </button>

                                <div class="flex items-center gap-1">
                                    <button v-for="pageNum in totalPages" :key="pageNum" @click="changePage(pageNum)"
                                        :class="[
                                            'px-3 py-2 rounded-lg font-medium transition-all',
                                            currentPage === pageNum
                                                ? 'bg-indigo-50 text-indigo-600'
                                                : 'hover:bg-gray-50'
                                        ]">
                                        {{ pageNum }}
                                    </button>
                                </div>

                                <button @click="changePage(currentPage + 1)" :disabled="currentPage === totalPages"
                                    class="px-3 py-2 rounded-lg border font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
                                    Next
                                </button>
                            </nav>
                        </div>

                        <!-- Empty State -->
                        <div v-if="filteredProducts.length === 0 && !loading" class="text-center py-12">
                            <div
                                class="w-16 h-16 bg-indigo-50 rounded-full flex items-center justify-center mx-auto mb-4">
                                <Package class="w-8 h-8 text-indigo-500" />
                            </div>
                            <h2 class="text-xl font-semibold text-gray-900 mb-2">No products found</h2>
                            <p v-if="searchQuery" class="text-gray-500 mb-6">
                                Try adjusting your search to find what you're looking for.
                            </p>
                            <p v-else class="text-gray-500 mb-6">
                                You haven't added any products yet. Start building your inventory!
                            </p>
                            <button @click="createNewProduct"
                                class="px-6 py-2.5 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white rounded-lg font-medium shadow-lg transition-all duration-300 inline-flex items-center gap-2">
                                <PlusCircle class="w-5 h-5" />
                                <span>Add New Product</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Modal -->
        <EditWishlistProductModal v-if="isEditModalOpen && localEditingProduct" :isEditModalOpen="isEditModalOpen"
            :localEditingProduct="localEditingProduct" :userId="userStore.user._id"
            @update:isEditModalOpen="isEditModalOpen = $event" @product-updated="handleProductUpdated" />
    </div>
</template>

<script>
import { ref, computed, onMounted, onUnmounted } from 'vue';
import { useRouter } from 'vue-router';
import { Search, PlusCircle } from 'lucide-vue-next';
import { useProductStore } from '../store/productStore';
import { useUserStore } from '../store/user';
import { toast } from 'vue-sonner';
import ProductCard from './ProductCard.vue';
import EditWishlistProductModal from './EditWishlistProductModal.vue';
import apiClient from '../api/axios';

export default {
    name: 'UserProducts',
    components: {
        ProductCard,
        EditWishlistProductModal,
        Search,
        PlusCircle
    },
    setup() {
        const router = useRouter();
        const productStore = useProductStore();
        const userStore = useUserStore();
        const userProducts = ref([]);
        const loading = ref(true);
        const error = ref(null);
        const searchQuery = ref('');
        const viewMode = ref('grid');
        const isEditModalOpen = ref(false);
        const localEditingProduct = ref(null);

        const currentPage = ref(1);
        const totalPages = ref(1);

        const fetchUserProducts = async () => {
            try {
                loading.value = true;
                error.value = null;

                // API call to include pagination params
                const response = await apiClient.get(`/products/${userStore.user._id}/products`, {
                    params: {
                        page: currentPage.value,
                        limit: 8
                    }
                });

                console.log('API response:', response.data);

                // Update how we handle the response ⬇️
                if (response.data?.products) {
                    userProducts.value = response.data.products;
                    totalPages.value = response.data.totalPages;
                    currentPage.value = response.data.currentPage;
                } else if (Array.isArray(response.data)) {
                    userProducts.value = response.data;
                } else {
                    console.error('Unexpected API response format:', response.data);
                    userProducts.value = [];
                }
            } catch (err) {
                console.error('Error fetching user products:', err);
                error.value = 'Failed to load products. Please try again.';
                toast.error(error.value);
            } finally {
                loading.value = false;
            }
        };

        // Function to change the current page
        const changePage = async (newPage) => {
            if (newPage >= 1 && newPage <= totalPages.value) {
                currentPage.value = newPage;
                await fetchUserProducts();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        };

        const filteredProducts = computed(() => {
            return userProducts.value.filter(product =>
                product.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                product.description.toLowerCase().includes(searchQuery.value.toLowerCase())
            );
        });

        const handleEditProduct = (productId) => {
            const productToEdit = userProducts.value.find(product => product._id === productId);
            if (productToEdit) {
                localEditingProduct.value = JSON.parse(JSON.stringify(productToEdit));
                isEditModalOpen.value = true;
            } else {
                console.error('Product not found:', productId);
                toast.error('Error: Product not found');
            }
        };

        const handleDeleteProduct = async (productId) => {
            try {
                await productStore.deleteProduct(productId);
                userProducts.value = userProducts.value.filter(product => product._id !== productId);
                toast.success('Product deleted successfully');
            } catch (error) {
                console.error('Error deleting product:', error);
                toast.error('Failed to delete product. Please try again.');
            }
        };

        const handleProductUpdated = async (updatedProduct) => {
            try {
                const result = await productStore.updateProduct(updatedProduct._id, updatedProduct);
                const index = userProducts.value.findIndex(p => p._id === result._id);
                if (index !== -1) {
                    userProducts.value[index] = result;
                } else {
                    userProducts.value.push(result);
                }
                isEditModalOpen.value = false;
                localEditingProduct.value = null;
                toast.success('Product updated successfully');
            } catch (error) {
                console.error('Error updating product:', error);
                toast.error('Failed to update product');
            }
        };

        const createNewProduct = () => {
            router.push('/account/profile/add-product');
        };

        // event listener for product creation
        const handleProductCreated = async () => {
            await fetchUserProducts();
        };

        onMounted(() => {
            if (userStore.isLoggedIn) {
                fetchUserProducts();
            }
            window.addEventListener('product-created', handleProductCreated);
        });

        onUnmounted(() => {
            window.removeEventListener('product-created', handleProductCreated);
        });

        return {
            userProducts,
            loading,
            error,
            searchQuery,
            viewMode,
            filteredProducts,
            isEditModalOpen,
            localEditingProduct,
            handleEditProduct,
            handleDeleteProduct,
            handleProductUpdated,
            createNewProduct,
            userStore,

            currentPage,
            totalPages,
            changePage,
        };
    }
}
</script>

<style scoped>
.my-user-products-page {
    min-height: calc(100vh - 64px);
}

.product-card {
    transition: all 0.3s ease;
}

.grid-enter-active,
.grid-leave-active,
.list-enter-active,
.list-leave-active {
    transition: all 0.5s ease;
}

.grid-enter-from,
.grid-leave-to,
.list-enter-from,
.list-leave-to {
    opacity: 0;
    transform: translateY(30px);
}
</style>