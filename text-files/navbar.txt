<template>
    <header class="flex flex-col w-full bg-white shadow-md lg:sticky -top-24 z-50">
        <!-- Top bar -->
        <div class="hidden lg:block w-full py-2 bg-gray-100">
            <div class="flex justify-end max-w-7xl mx-auto px-4 text-gray-500 text-xs space-x-2 md:space-x-4">
                <a href="#" class="hover:text-gray-700 text-[#374141]">My Discount</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Coupons</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Sell on Kaalis</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Help & Support</a>
            </div>
        </div>

        <!-- Main navbar -->
        <div class="flex items-center justify-between w-full px-4 pt-3 lg:py-3 md:px-6 lg:px-8">
            <!-- Hamburger menu (mobile only) -->
            <button @click="toggleMenu" class="lg:hidden text-[#363636]">
                <Menu class="w-6 h-6" />
            </button>

            <!-- Logo -->
            <div class="text-center lg:text-left flex-shrink-0">
                <router-link to="/" class="inline-block">
                    <p class="text-[#272425] text-xl pl-2 sm:text-3xl font-semibold">Bruthol</p>
                </router-link>
            </div>

            <!-- Search Bar (hidden on mobile) -->
            <div class="hidden lg:block flex-1 mx-4 max-w-2xl">
                <div class="relative flex items-center">
                    <Search class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                    <input type="text" placeholder="Write the product, category or brand you are looking for"
                        class="w-full text-[#363636] bg-[#f3f3f3] pl-10 pr-4 py-2 rounded-l-full focus:outline-none focus:ring-1 focus:ring-[#ff2f62] focus:border-transparent" />
                    <button
                        class="bg-gradient-to-t from-[#ff934b] to-[#ff5e62] hover:from-[#ff5e62] hover:to-[#ff934b] text-white font-light py-2 px-4 rounded-r-full focus:outline-none transition duration-300 ease-in-out">
                        Search
                    </button>
                </div>
            </div>

            <!-- User Links -->
            <div class="w-full sm:w-auto flex justify-end sm:justify-end items-center space-x-4">
                <DropdownMenu>
                    <DropdownMenuTrigger as-child>
                        <Button variant="outline"
                            class="flex items-center text-[#363636] hover:text-[#ff5e62] transition duration-300">
                            <UserRound class="hover:fill-[#ff5e62] w-5 h-5" />
                            <span class="text-xs font-medium ml-1 hidden lg:inline">{{ isLoggedIn ? `Hi
                                ${user.username}` : 'Login' }}</span>
                        </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent class="w-56">
                        <DropdownMenuLabel>
                            <div class="flex items-center justify-between bg-[#24a3b5] py-3 px-4 rounded-t-sm">
                                <div class="flex items-center gap-5">
                                    <div class="bg-white rounded-full w-10 h-10 flex items-center justify-center">
                                        <CircleUserRound class="text-[#24a3b5] w-7 h-7 rounded-full text-gray-200" />
                                        <img src="../assets/images/Kyrian.png" alt="profile"
                                            class="hidden w-10 h-10 rounded-full cursor-pointer">
                                    </div>
                                    <div>
                                        <DropdownMenuItem v-if="!isLoggedIn"
                                            class="text-xs hover:text-[#363636] font-medium px-2 py-0">
                                            <router-link to="/login" class="text-white py-1 hover:text-[#24a3b5]">
                                                Login/Register
                                            </router-link>
                                        </DropdownMenuItem>
                                        <DropdownMenuItem v-else
                                            class="text-xs hover:text-[#363636] font-medium py-0 hover:text-[#24a3b5]">
                                            <router-link to="/orders" class="text-white py-1 hover:text-[#24a3b5]">
                                                {{ user.username }}
                                            </router-link>
                                        </DropdownMenuItem>
                                    </div>
                                </div>
                            </div>
                        </DropdownMenuLabel>
                        <DropdownMenuSeparator />
                        <DropdownMenuGroup v-if="isLoggedIn">
                            <DropdownMenuItem class="flex flex-col items-start space-y-1">
                                <span v-for="item in menuItems" :key="item.label" class="w-full p-1">
                                    <router-link active-class="active-link" :to="item.link"
                                        class="flex items-center text-gray-700 hover:text-[#24a3b5] transition-colors duration-300">
                                        <component :is="item.icon" class="w-5 h-5 mr-2 flex-shrink-0" />
                                        <span class="text-xs whitespace-nowrap">{{ item.label }}</span>
                                    </router-link>
                                </span>
                            </DropdownMenuItem>
                        </DropdownMenuGroup>
                        <DropdownMenuSeparator />
                        <div v-if="isLoggedIn">
                            <DropdownMenuItem @click="logout">
                                <span>Log out</span>
                            </DropdownMenuItem>
                        </div>
                    </DropdownMenuContent>
                </DropdownMenu>
                <button class="text-[#363636] hover:text-[#ff5e62] transition duration-300">
                    <Heart class="hover:fill-[#ff5e62] w-5 h-5" />
                </button>
                <button @click="navigateToCart"
                    class="text-[#363636] hover:text-[#ff5e62] transition duration-300 relative">
                    <ShoppingCart class="hover:fill-[#ff5e62] w-5 h-5" />
                    <span v-if="cartCount > 0"
                        class="absolute -top-2 -right-2 bg-[#ff5e62] text-white rounded-full text-xs w-5 h-5 flex items-center justify-center">
                        {{ cartCount }}
                    </span>
                </button>
            </div>
        </div>

        <!-- Search Bar (mobile) -->
        <div class=" lg:hidden mx-4">
            <div class="relative flex items-center">
                <Search class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                <input type="text" placeholder="What is on your mind today?"
                    class="w-full text-[#363636] bg-[#f3f3f3] pl-10 pr-4 py-2 rounded-sm focus:outline-none focus:ring-1 focus:ring-[#ff2f62] focus:border-transparent" />
            </div>
        </div>

        <!-- Mobile menu (slides from left) -->
        <transition name="slide">
            <div v-if="isMenuOpen" class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg z-50 lg:hidden overflow-y-auto"
                v-click-outside="handleClickOutside">
                <div class="flex justify-end p-4">
                    <button @click="toggleMenu" class="text-[#363636]">
                        <X class="w-6 h-6" />
                    </button>
                </div>
                <nav class="px-4">
                    <!-- Categories -->
                    <h3 class="font-semibold text-lg mb-2">Categories</h3>
                    <ul class="space-y-2 mb-6">
                        <li v-for="category in categoryItems" :key="category.name">
                            <router-link :to="category.link" @click="closeMenu"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <i :class="[category.icon, 'w-5 h-5 mr-2']"></i>
                                <span>{{ category.name }}</span>
                            </router-link>
                        </li>
                    </ul>

                    <!-- Menu Items -->
                    <h3 class="font-semibold text-lg mb-2">Menu</h3>
                    <ul class="space-y-2">
                        <li v-for="item in menuItems" :key="item.label">
                            <router-link :to="item.link"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <i :class="[item.icon, 'w-5 h-5 mr-2']"></i>
                                <span>{{ item.label }}</span>
                            </router-link>
                        </li>
                    </ul>
                </nav>
            </div>
        </transition>
        <nav class="hidden lg:block bg-[#f7f7f7] py-2 overflow-x-auto">
            <ul class="flex list-none p-0 m-0 whitespace-nowrap">
                <li v-for="category in categoryItems" :key="category.name" class="inline-block mx-4">
                    <router-link :to="category.link" class="text-[#333] hover:text-[#ff6f61]">
                        <span>{{ category.name }}</span>
                    </router-link>
                </li>
            </ul>
        </nav>
    </header>
</template>

<script>
import {
    Popover,
    PopoverContent,
    PopoverTrigger,
} from '@/components/ui/popover'
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuGroup,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuPortal,
    DropdownMenuSeparator,
    DropdownMenuShortcut,
    DropdownMenuSub,
    DropdownMenuSubContent,
    DropdownMenuSubTrigger,
    DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { Label } from '@/components/ui/label'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import {
    UserRound, CircleUserRound, Heart, ShoppingCart, Search, ChevronRight, Menu, X, PackageOpen,
    Wallet,
    User,
    Box,
    Star,
    Store,
    HelpCircle
} from 'lucide-vue-next';
import { menuItems } from '../utils/menuItems.js';
import { categoryItems } from '../utils/categoryItems.js';
import { useUserStore } from '../store/user';
import { useCartStore } from '../store/cart';
import { toast } from 'vue-sonner';
import { ref, computed, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import { clickOutside } from '../utils/clickOutside.js';

export default {
    name: 'Navbar',
    components: {
        Input,
        Label,
        Popover,
        PopoverContent,
        PopoverTrigger,
        UserRound,
        CircleUserRound,
        Heart,
        ShoppingCart,
        Search,
        ChevronRight,
        PackageOpen,
        Wallet,
        User,
        Box,
        Star,
        Store,
        HelpCircle,
        Button,
        DropdownMenu,
        DropdownMenuContent,
        DropdownMenuGroup,
        DropdownMenuItem,
        DropdownMenuLabel,
        DropdownMenuPortal,
        DropdownMenuSeparator,
        DropdownMenuShortcut,
        DropdownMenuSub,
        DropdownMenuSubContent,
        DropdownMenuSubTrigger,
        DropdownMenuTrigger,
        Menu,
        X,
    },

    props: {
        isMenuOpen: Boolean
    },

    emits: ['toggleSidebar', 'closeMenu'],

    directives: {
        clickOutside
    },

    setup(props, { emit }) {
        const userStore = useUserStore();
        const cartStore = useCartStore();
        const router = useRouter();

        const isLoggedIn = computed(() => userStore.isLoggedIn);
        const user = computed(() => userStore.user || { username: 'Guest' });
        const cartCount = computed(() => cartStore.cartCount);

        onMounted(async () => {
            if (userStore.isLoggedIn) {
                await cartStore.fetchCart();
            }
        });

        const logout = () => {
            toast.success("Logged Out Successfully");
            userStore.clearUser();
            router.push('/');
            console.log("Local storage after logout:", localStorage);
        };

        const toggleMenu = (event) => {
            event.stopPropagation();
            emit('toggleSidebar');
        };

        const closeMenu = () => {
            console.log('Closing menu');  // Add this line for debugging
            emit('closeMenu');
        };

        const handleClickOutside = () => {
            setTimeout(closeMenu, 0);
        };

        const navigateToCart = () => {
            router.push({ name: 'Cart' });
        };

        return {
            isLoggedIn,
            user,
            logout,
            toggleMenu,
            closeMenu,
            menuItems,
            categoryItems,
            handleClickOutside,
            cartCount,
            navigateToCart
        };
    }
}
</script>

<style scoped>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: #f7f7f7;
}

@media (max-width: 640px) {
    .w-full>* {
        margin-bottom: 0.5rem;
    }
}

.button-hover {
    transition: all 0.3s ease;
}

.button-hover:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.active-link {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    background-color: #24a3b5;
    color: white !important;
    display: block;
    width: 100%;
    padding: 4px;
    border-radius: 4px;
    margin-top: -10px;
}

.active-link>*,
.router-link-active>* {
    flex-shrink: 0;
}

.slide-enter-active,
.slide-leave-active {
    transition: transform 0.5s ease-in-out;
}

.slide-enter-from,
.slide-leave-to {
    transform: translateX(-100%);
}

.slide-enter-to,
.slide-leave-from {
    transform: translateX(0);
}

/* Smooth scrolling for category nav */
.overflow-x-auto {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

/* Hide scrollbar for Chrome, Safari and Opera */
.overflow-x-auto::-webkit-scrollbar {
    display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
.overflow-x-auto {
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
}
</style>



============================================================version 2========================================================
<template>
    <header class="flex flex-col w-full bg-white shadow-md lg:sticky -top-24 z-50">
        <!-- Top bar -->
        <div class="hidden lg:block w-full py-2 bg-gray-100">
            <div class="flex justify-end max-w-7xl mx-auto px-4 text-gray-500 text-xs space-x-2 md:space-x-4">
                <a href="#" class="hover:text-gray-700 text-[#374141]">My Discount</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Coupons</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Sell on Kaalis</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Help & Support</a>
            </div>
        </div>

        <!-- Main navbar -->
        <div class="flex items-center justify-between w-full px-4 pt-3 lg:py-3 md:px-6 lg:px-8">
            <!-- Hamburger menu (mobile only) -->
            <button @click="toggleMenu" class="lg:hidden text-[#363636]">
                <Menu class="w-6 h-6" />
            </button>

            <!-- Logo -->
            <div class="text-center lg:text-left flex-shrink-0">
                <router-link to="/" class="inline-block">
                    <p class="text-[#272425] text-xl pl-2 sm:text-3xl font-semibold">Bruthol</p>
                </router-link>
            </div>

            <!-- Search Bar (hidden on mobile) -->
            <div class="hidden lg:block flex-1 mx-4 max-w-2xl">
                <div class="relative flex items-center">
                    <Search class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                    <input type="text" placeholder="Write the product, category or brand you are looking for"
                        class="w-full text-[#363636] bg-[#f3f3f3] pl-10 pr-4 py-2 rounded-l-full focus:outline-none focus:ring-1 focus:ring-[#ff2f62] focus:border-transparent" />
                    <button
                        class="bg-gradient-to-t from-[#ff934b] to-[#ff5e62] hover:from-[#ff5e62] hover:to-[#ff934b] text-white font-light py-2 px-4 rounded-r-full focus:outline-none transition duration-300 ease-in-out">
                        Search
                    </button>
                </div>
            </div>

            <!-- User Links -->
            <div class="w-full sm:w-auto flex justify-end sm:justify-end items-center space-x-4">
                <DropdownMenu>
                    <DropdownMenuTrigger as-child>
                        <Button variant="outline"
                            class="flex items-center text-[#363636] hover:text-[#ff5e62] transition duration-300">
                            <UserRound class="hover:fill-[#ff5e62] w-5 h-5" />
                            <span class="text-xs font-medium ml-1 hidden lg:inline">{{ isLoggedIn ? `Hi
                                ${user.username}` : 'Login' }}</span>
                        </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent class="w-56">
                        <DropdownMenuLabel>
                            <div class="flex items-center justify-between bg-[#24a3b5] py-3 px-4 rounded-t-sm">
                                <div class="flex items-center gap-5">
                                    <div class="bg-white rounded-full w-10 h-10 flex items-center justify-center">
                                        <CircleUserRound class="text-[#24a3b5] w-7 h-7 rounded-full text-gray-200" />
                                        <img src="../assets/images/Kyrian.png" alt="profile"
                                            class="hidden w-10 h-10 rounded-full cursor-pointer">
                                    </div>
                                    <div>
                                        <DropdownMenuItem v-if="!isLoggedIn"
                                            class="text-xs hover:text-[#363636] font-medium px-2 py-0">
                                            <router-link to="/login" class="text-white py-1 hover:text-[#24a3b5]">
                                                Login/Register
                                            </router-link>
                                        </DropdownMenuItem>
                                        <DropdownMenuItem v-else
                                            class="text-xs hover:text-[#363636] font-medium py-0 hover:text-[#24a3b5]">
                                            <router-link to="/orders" class="text-white py-1 hover:text-[#24a3b5]">
                                                {{ user.username }}
                                            </router-link>
                                        </DropdownMenuItem>
                                    </div>
                                </div>
                            </div>
                        </DropdownMenuLabel>
                        <DropdownMenuSeparator />
                        <DropdownMenuGroup v-if="isLoggedIn">
                            <DropdownMenuItem class="flex flex-col items-start space-y-1">
                                <span v-for="item in menuItems" :key="item.label" class="w-full p-1">
                                    <router-link active-class="active-link" :to="item.link"
                                        class="flex items-center text-gray-700 hover:text-[#24a3b5] transition-colors duration-300">
                                        <component :is="item.icon" class="w-5 h-5 mr-2 flex-shrink-0" />
                                        <span class="text-xs whitespace-nowrap">{{ item.label }}</span>
                                    </router-link>
                                </span>
                            </DropdownMenuItem>
                        </DropdownMenuGroup>
                        <DropdownMenuSeparator />
                        <div v-if="isLoggedIn">
                            <DropdownMenuItem @click="logout">
                                <span>Log out</span>
                            </DropdownMenuItem>
                        </div>
                    </DropdownMenuContent>
                </DropdownMenu>
                <button class="text-[#363636] hover:text-[#ff5e62] transition duration-300">
                    <Heart class="hover:fill-[#ff5e62] w-5 h-5" />
                </button>
                <button @click="navigateToCart"
                    class="text-[#363636] hover:text-[#ff5e62] transition duration-300 relative">
                    <ShoppingCart class="hover:fill-[#ff5e62] w-5 h-5" />
                    <span v-if="cartCount > 0"
                        class="absolute -top-2 -right-2 bg-[#ff5e62] text-white rounded-full text-xs w-5 h-5 flex items-center justify-center">
                        {{ cartCount }}
                    </span>
                </button>
            </div>
        </div>

        <!-- Search Bar (mobile) -->
        <div class=" lg:hidden mx-4">
            <div class="relative flex items-center">
                <Search class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                <input type="text" placeholder="What is on your mind today?"
                    class="w-full text-[#363636] bg-[#f3f3f3] pl-10 pr-4 py-2 rounded-sm focus:outline-none focus:ring-1 focus:ring-[#ff2f62] focus:border-transparent" />
            </div>
        </div>

        <!-- Mobile menu (slides from left) -->
        <transition name="slide">
            <div v-if="isMenuOpen" class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg z-50 lg:hidden overflow-y-auto"
                v-click-outside="handleClickOutside">
                <div class="flex justify-end p-4">
                    <button @click="toggleMenu" class="text-[#363636]">
                        <X class="w-6 h-6" />
                    </button>
                </div>
                <nav class="px-4">
                    <!-- Categories -->
                    <h3 class="font-semibold text-lg mb-2">Categories</h3>
                    <ul class="space-y-2 mb-6">
                        <li v-for="category in categoryItems" :key="category.name">
                            <router-link :to="category.link" @click="closeMenu"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <i :class="[category.icon, 'w-5 h-5 mr-2']"></i>
                                <span>{{ category.name }}</span>
                            </router-link>
                        </li>
                    </ul>

                    <!-- Menu Items -->
                    <h3 class="font-semibold text-lg mb-2">Menu</h3>
                    <ul class="space-y-2">
                        <li v-for="item in menuItems" :key="item.label">
                            <router-link :to="item.link"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <i :class="[item.icon, 'w-5 h-5 mr-2']"></i>
                                <span>{{ item.label }}</span>
                            </router-link>
                        </li>
                    </ul>
                </nav>
            </div>
        </transition>
        <nav class="hidden lg:block bg-[#f7f7f7] py-2 overflow-x-auto">
            <ul class="flex list-none p-0 m-0 whitespace-nowrap">
                <li v-for="category in categoryItems" :key="category.name" class="inline-block mx-4">
                    <router-link :to="category.link" class="text-[#333] hover:text-[#ff6f61]">
                        <span>{{ category.name }}</span>
                    </router-link>
                </li>
            </ul>
        </nav>
    </header>
</template>

<script>
import {
    Popover,
    PopoverContent,
    PopoverTrigger,
} from '@/components/ui/popover'
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuGroup,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuPortal,
    DropdownMenuSeparator,
    DropdownMenuShortcut,
    DropdownMenuSub,
    DropdownMenuSubContent,
    DropdownMenuSubTrigger,
    DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { Label } from '@/components/ui/label'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import {
    UserRound, CircleUserRound, Heart, ShoppingCart, Search, ChevronRight, Menu, X, PackageOpen,
    Wallet,
    User,
    Box,
    Star,
    Store,
    HelpCircle
} from 'lucide-vue-next';
import { menuItems } from '../utils/menuItems.js';
import { categoryItems } from '../utils/categoryItems.js';
import { useUserStore } from '../store/user';
import { useCartStore } from '../store/cart';
import { toast } from 'vue-sonner';
import { ref, computed, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import { clickOutside } from '../utils/clickOutside.js';

export default {
    name: 'Navbar',
    components: {
        Input,
        Label,
        Popover,
        PopoverContent,
        PopoverTrigger,
        UserRound,
        CircleUserRound,
        Heart,
        ShoppingCart,
        Search,
        ChevronRight,
        PackageOpen,
        Wallet,
        User,
        Box,
        Star,
        Store,
        HelpCircle,
        Button,
        DropdownMenu,
        DropdownMenuContent,
        DropdownMenuGroup,
        DropdownMenuItem,
        DropdownMenuLabel,
        DropdownMenuPortal,
        DropdownMenuSeparator,
        DropdownMenuShortcut,
        DropdownMenuSub,
        DropdownMenuSubContent,
        DropdownMenuSubTrigger,
        DropdownMenuTrigger,
        Menu,
        X,
    },

    props: {
        isMenuOpen: Boolean
    },

    emits: ['toggleSidebar', 'closeMenu'],

    directives: {
        clickOutside
    },

    setup(props, { emit }) {
        const userStore = useUserStore();
        const cartStore = useCartStore();
        const router = useRouter();

        const isLoggedIn = computed(() => userStore.isLoggedIn);
        const user = computed(() => userStore.user || { username: 'Guest' });
        const cartCount = computed(() => cartStore.cartCount);

        onMounted(async () => {
            if (userStore.isLoggedIn) {
                await cartStore.fetchCart();
            }
        });

        const logout = () => {
            toast.success("Logged Out Successfully");
            userStore.clearUser();
            router.push('/');
            console.log("Local storage after logout:", localStorage);
        };

        const toggleMenu = (event) => {
            event.stopPropagation();
            emit('toggleSidebar');
        };

        const closeMenu = () => {
            console.log('Closing menu');  // Add this line for debugging
            emit('closeMenu');
        };

        const handleClickOutside = () => {
            setTimeout(closeMenu, 0);
        };

        const navigateToCart = () => {
            router.push({ name: 'Cart' });
        };

        return {
            isLoggedIn,
            user,
            logout,
            toggleMenu,
            closeMenu,
            menuItems,
            categoryItems,
            handleClickOutside,
            cartCount,
            navigateToCart
        };
    }
}
</script>

<style scoped>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: #f7f7f7;
}

@media (max-width: 640px) {
    .w-full>* {
        margin-bottom: 0.5rem;
    }
}

.button-hover {
    transition: all 0.3s ease;
}

.button-hover:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.active-link {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    background-color: #24a3b5;
    color: white !important;
    display: block;
    width: 100%;
    padding: 4px;
    border-radius: 4px;
    margin-top: -10px;
}

.active-link>*,
.router-link-active>* {
    flex-shrink: 0;
}

.slide-enter-active,
.slide-leave-active {
    transition: transform 0.5s ease-in-out;
}

.slide-enter-from,
.slide-leave-to {
    transform: translateX(-100%);
}

.slide-enter-to,
.slide-leave-from {
    transform: translateX(0);
}

/* Smooth scrolling for category nav */
.overflow-x-auto {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

/* Hide scrollbar for Chrome, Safari and Opera */
.overflow-x-auto::-webkit-scrollbar {
    display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
.overflow-x-auto {
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
}
</style>




===================================Updated with All Categories version 2 =========================

<template>
    <header class="flex flex-col w-full bg-white shadow-md lg:sticky -top-24 z-50">
        <!-- Top bar -->
        <div class="hidden lg:block w-full py-2 bg-gray-100">
            <div class="flex justify-end max-w-7xl mx-auto px-4 text-gray-500 text-xs space-x-2 md:space-x-4">
                <a href="#" class="hover:text-gray-700 text-[#374141]">My Discount</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Coupons</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Sell on Kaalis</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Help & Support</a>
            </div>
        </div>

        <!-- Main navbar -->
        <div class="flex items-center justify-between w-full px-4 pt-3 lg:py-3 md:px-6 lg:px-8">
            <!-- Hamburger menu (mobile only) -->
            <button @click="toggleMenu" class="lg:hidden text-[#363636]">
                <Menu class="w-6 h-6" />
            </button>

            <!-- Logo -->
            <div class="text-center lg:text-left flex-shrink-0">
                <router-link to="/" class="inline-block">
                    <p class="text-[#272425] text-xl pl-2 sm:text-3xl font-semibold">Bruthol</p>
                </router-link>
            </div>

            <!-- Search Bar -->
            <div class="hidden lg:block flex-1 mx-4 max-w-2xl">
                <div class="relative flex items-center">
                    <Search class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                    <input type="text" placeholder="Write the product, category or brand you are looking for"
                        class="w-full text-[#363636] bg-[#f3f3f3] pl-10 pr-4 py-2 rounded-l-full focus:outline-none focus:ring-1 focus:ring-[#ff2f62] focus:border-transparent" />
                    <button
                        class="bg-gradient-to-t from-[#ff934b] to-[#ff5e62] hover:from-[#ff5e62] hover:to-[#ff934b] text-white font-light py-2 px-4 rounded-r-full focus:outline-none transition duration-300 ease-in-out">
                        Search
                    </button>
                </div>
            </div>

            <!-- User Links -->
            <div class="w-full sm:w-auto flex justify-end sm:justify-end items-center space-x-4">
                <DropdownMenu>
                    <DropdownMenuTrigger as-child>
                        <Button variant="outline"
                            class="flex items-center text-[#363636] hover:text-[#ff5e62] transition duration-300">
                            <UserRound class="hover:fill-[#ff5e62] w-5 h-5" />
                            <span class="text-xs font-medium ml-1 hidden lg:inline">{{ isLoggedIn ? `Hi
                                ${user.username}` : 'Login' }}</span>
                        </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent class="w-56">
                        <DropdownMenuLabel>
                            <div class="flex items-center justify-between bg-[#24a3b5] py-3 px-4 rounded-t-sm">
                                <div class="flex items-center gap-5">
                                    <div class="bg-white rounded-full w-10 h-10 flex items-center justify-center">
                                        <CircleUserRound class="text-[#24a3b5] w-7 h-7 rounded-full text-gray-200" />
                                        <img src="../assets/images/Kyrian.png" alt="profile"
                                            class="hidden w-10 h-10 rounded-full cursor-pointer">
                                    </div>
                                    <div>
                                        <DropdownMenuItem v-if="!isLoggedIn"
                                            class="text-xs hover:text-[#363636] font-medium px-2 py-0">
                                            <router-link to="/login" class="text-white py-1 hover:text-[#24a3b5]">
                                                Login/Register
                                            </router-link>
                                        </DropdownMenuItem>
                                        <DropdownMenuItem v-else
                                            class="text-xs hover:text-[#363636] font-medium py-0 hover:text-[#24a3b5]">
                                            <router-link to="/orders" class="text-white py-1 hover:text-[#24a3b5]">
                                                {{ user.username }}
                                            </router-link>
                                        </DropdownMenuItem>
                                    </div>
                                </div>
                            </div>
                        </DropdownMenuLabel>
                        <DropdownMenuSeparator />
                        <DropdownMenuGroup v-if="isLoggedIn">
                            <DropdownMenuItem class="flex flex-col items-start space-y-1">
                                <span v-for="item in menuItems" :key="item.label" class="w-full p-1">
                                    <router-link active-class="active-link" :to="item.link"
                                        class="flex items-center text-gray-700 hover:text-[#24a3b5] transition-colors duration-300">
                                        <component :is="item.icon" class="w-5 h-5 mr-2 flex-shrink-0" />
                                        <span class="text-xs whitespace-nowrap">{{ item.label }}</span>
                                    </router-link>
                                </span>
                            </DropdownMenuItem>
                        </DropdownMenuGroup>
                        <DropdownMenuSeparator />
                        <div v-if="isLoggedIn">
                            <DropdownMenuItem @click="logout">
                                <span>Log out</span>
                            </DropdownMenuItem>
                        </div>
                    </DropdownMenuContent>
                </DropdownMenu>
                <button class="text-[#363636] hover:text-[#ff5e62] transition duration-300">
                    <Heart class="hover:fill-[#ff5e62] w-5 h-5" />
                </button>
                <button @click="navigateToCart"
                    class="text-[#363636] hover:text-[#ff5e62] transition duration-300 relative">
                    <ShoppingCart class="hover:fill-[#ff5e62] w-5 h-5" />
                    <span v-if="cartCount > 0"
                        class="absolute -top-2 -right-2 bg-[#ff5e62] text-white rounded-full text-xs w-5 h-5 flex items-center justify-center">
                        {{ cartCount }}
                    </span>
                </button>
            </div>
        </div>

        <!-- Categories nav -->
        <nav class="flex bg-white py-2 overflow-x-auto border-t border-b border-gray-200">
            <div class="hidden lg:flex items-center px-4 border-r border-gray-200">
                <button @click="toggleCategoryMenu"
                    class="flex items-center space-x-2 text-gray-700 hover:text-gray-900">
                    <Menu class="w-6 h-6" />
                    <span class="font-medium text-xs">ALL CATEGORIES</span>
                    <ChevronDown class="w-4 h-4" :class="{ 'transform rotate-180': isCategoryMenuOpen }" />
                </button>
                <!-- Category dropdown menu -->
                <div v-if="isCategoryMenuOpen" class="absolute top-full left-0 w-64 bg-white shadow-lg z-50 mt-1">
                    <ul class="py-2">
                        <li v-for="category in mainCategories" :key="category._id" class="px-4 py-2 hover:bg-gray-100">
                            <router-link :to="`/category/${category.slug}`"
                                class="block text-xs text-gray-700 hover:text-gray-900">
                                {{ category.name }}
                            </router-link>
                        </li>
                    </ul>
                </div>
            </div>
            <ul class="flex list-none p-0 m-0 whitespace-nowrap">
                <li v-for="category in mainCategories" :key="category._id" class="inline-block mx-4">
                    <router-link :to="`/category/${category.slug}`" class="text-xs text-[#333] hover:text-[#ff6f61]">
                        <span>{{ category.name }}</span>
                    </router-link>
                </li>
            </ul>
        </nav>

        <!-- Search Bar (mobile) -->
        <div class="lg:hidden mx-4 my-2">
            <div class="relative flex items-center">
                <Search class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                <input type="text" placeholder="What is on your mind today?"
                    class="w-full text-[#363636] bg-[#f3f3f3] pl-10 pr-4 py-2 rounded-sm focus:outline-none focus:ring-1 focus:ring-[#ff2f62] focus:border-transparent" />
            </div>
        </div>

        <!-- Mobile menu (slides from left) -->
        <transition name="slide">
            <div v-if="isMenuOpen" class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg z-50 lg:hidden overflow-y-auto"
                v-click-outside="handleClickOutside">
                <div class="flex justify-end p-4">
                    <button @click="toggleMenu" class="text-[#363636]">
                        <X class="w-6 h-6" />
                    </button>
                </div>
                <nav class="px-4">
                    <!-- Categories -->
                    <h3 class="font-semibold text-lg mb-2">Categories</h3>
                    <ul class="space-y-2 mb-6">
                        <li>
                            <router-link to="/electronics-and-robots" @click="closeMenu"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <span>Electronics and Robots</span>
                            </router-link>
                        </li>
                        <li>
                            <router-link to="/electronics" @click="closeMenu"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <span>Electronics</span>
                            </router-link>
                        </li>
                        <li v-for="category in mainCategories" :key="category._id">
                            <router-link :to="`/category/${category.slug}`" @click="closeMenu"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <span>{{ category.name }}</span>
                            </router-link>
                        </li>
                    </ul>

                    <!-- Menu Items -->
                    <h3 class="font-semibold text-lg mb-2">Menu</h3>
                    <ul class="space-y-2">
                        <li v-for="item in menuItems" :key="item.label">
                            <router-link :to="item.link"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <i :class="[item.icon, 'w-5 h-5 mr-2']"></i>
                                <span>{{ item.label }}</span>
                            </router-link>
                        </li>
                    </ul>
                </nav>
            </div>
        </transition>
    </header>
</template>

<script>
import {
    Popover,
    PopoverContent,
    PopoverTrigger,
} from '@/components/ui/popover'
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuGroup,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuPortal,
    DropdownMenuSeparator,
    DropdownMenuShortcut,
    DropdownMenuSub,
    DropdownMenuSubContent,
    DropdownMenuSubTrigger,
    DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { Label } from '@/components/ui/label'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import {
    UserRound, CircleUserRound, Heart, ShoppingCart, Search, ChevronRight, Menu, X, PackageOpen,
    Wallet,
    User,
    Box,
    Star,
    Store,
    HelpCircle,
    ChevronDown
} from 'lucide-vue-next';

import { menuItems } from '../utils/menuItems.js';
import { useUserStore } from '../store/user';
import { useCartStore } from '../store/cart';
import { toast } from 'vue-sonner';
import { useProductStore } from '../store/productStore.js';
import { storeToRefs } from 'pinia';
import { computed, onMounted, onUnmounted, ref } from 'vue';
import { useRouter } from 'vue-router';
import { clickOutside } from '../utils/clickOutside.js';

export default {
    name: 'Navbar',
    components: {
        Input,
        Label,
        Popover,
        PopoverContent,
        PopoverTrigger,
        UserRound,
        CircleUserRound,
        Heart,
        ShoppingCart,
        Search,
        ChevronRight,
        PackageOpen,
        Wallet,
        User,
        Box,
        Star,
        Store,
        HelpCircle,
        ChevronDown,
        Button,
        DropdownMenu,
        DropdownMenuContent,
        DropdownMenuGroup,
        DropdownMenuItem,
        DropdownMenuLabel,
        DropdownMenuPortal,
        DropdownMenuSeparator,
        DropdownMenuShortcut,
        DropdownMenuSub,
        DropdownMenuSubContent,
        DropdownMenuSubTrigger,
        DropdownMenuTrigger,
        Menu,
        X,
    },

    props: {
        isMenuOpen: Boolean
    },

    emits: ['toggleSidebar', 'closeMenu'],

    directives: {
        clickOutside
    },

    setup(props, { emit }) {
        const userStore = useUserStore();
        const cartStore = useCartStore();
        const router = useRouter();

        const isLoggedIn = computed(() => userStore.isLoggedIn);
        const user = computed(() => userStore.user || { username: 'Guest' });
        const cartCount = computed(() => cartStore.cartCount);

        const productStore = useProductStore();
        const { categories } = storeToRefs(productStore);

        console.log('categories: ', categories)

        const mainCategories = computed(() => {
            return categories.value ? categories.value.filter(category => !category.parent) : [];
        });

        const isLoading = ref(true);

        const isCategoryMenuOpen = ref(false);

        const toggleCategoryMenu = () => {
            event.stopPropagation(); // Prevent the click from propagating to the document
            isCategoryMenuOpen.value = !isCategoryMenuOpen.value;
        };

        const closeCategoryMenu = () => {
            isCategoryMenuOpen.value = false;
        };

        onMounted(async () => {
            if (userStore.isLoggedIn) {
                try {
                    await cartStore.fetchCart();
                    await productStore.fetchCategories();
                } catch (error) {
                    console.error('Failed to fetch data:', error);
                    if (error.response && error.response.status === 401) {
                        handleUnauthorized();
                    }
                } finally {
                    isLoading.value = false;
                }
            } else {
                try {
                    await productStore.fetchPublicCategories();
                } catch (error) {
                    console.error('Failed to fetch public categories:', error);
                } finally {
                    isLoading.value = false;
                }
            }

            document.addEventListener('click', handleClickOutside);
        });

        onUnmounted(() => {
            document.removeEventListener('click', handleClickOutside);
        });

        const handleUnauthorized = () => {
            userStore.clearUser();
            cartStore.$reset();
            productStore.$reset();
            router.push('/login');
        };


        const logout = () => {
            userStore.clearUser(); // This should remove the token
            cartStore.$reset(); // Reset cart state
            productStore.$reset(); // Reset product state
            router.push('/');
            toast.success("Logged Out Successfully");
        };

        const toggleMenu = (event) => {
            event.stopPropagation();
            emit('toggleSidebar');
        };

        const closeMenu = () => {
            console.log('Closing menu');  // Add this line for debugging
            emit('closeMenu');
        };

        // Close category menu when clicking outside
        const handleClickOutside = (event) => {
            setTimeout(closeMenu, 0);

            if (isCategoryMenuOpen.value && !event.target.closest('.category-menu')) {
                // isCategoryMenuOpen.value = false;
                closeCategoryMenu();
            }

            // Only close the mobile menu if it's open (you might need to add a prop or ref for this)
            if (props.isMenuOpen && !event.target.closest('.mobile-menu')) {
                closeMenu();
            }
        };

        const navigateToCart = () => {
            router.push({ name: 'Cart' });
        };

        return {
            isLoggedIn,
            user,
            logout,
            toggleMenu,
            closeMenu,
            menuItems,
            handleClickOutside,
            cartCount,
            navigateToCart,
            mainCategories,
            isLoading,
            categories,
            isCategoryMenuOpen,
            toggleCategoryMenu,
        };
    }
}
</script>

<style scoped>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: #f7f7f7;
}

@media (max-width: 640px) {
    .w-full>* {
        margin-bottom: 0.5rem;
    }
}

.button-hover {
    transition: all 0.3s ease;
}

.button-hover:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.active-link {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    background-color: #24a3b5;
    color: white !important;
    display: block;
    width: 100%;
    padding: 4px;
    border-radius: 4px;
    margin-top: -10px;
}

.active-link>*,
.router-link-active>* {
    flex-shrink: 0;
}

.slide-enter-active,
.slide-leave-active {
    transition: transform 0.5s ease-in-out;
}

.slide-enter-from,
.slide-leave-to {
    transform: translateX(-100%);
}

.slide-enter-to,
.slide-leave-from {
    transform: translateX(0);
}

/* Smooth scrolling for category nav */
.overflow-x-auto {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

/* Hide scrollbar for Chrome, Safari and Opera */
.overflow-x-auto::-webkit-scrollbar {
    display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
.overflow-x-auto {
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
}

.category-menu {
    position: relative;
}

.category-menu-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 50;
    background-color: white;
    border: 1px solid #e2e8f0;
    border-radius: 0.375rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}
</style>




===================================Updated with All Categories version 3 =========================

<template>
    <header class="flex flex-col w-full bg-white shadow-md lg:sticky -top-24 z-50">
        <!-- Top bar -->
        <div class="hidden lg:block w-full py-2 bg-gray-100">
            <div class="flex justify-end max-w-7xl mx-auto px-4 text-gray-500 text-xs space-x-2 md:space-x-4">
                <a href="#" class="hover:text-gray-700 text-[#374141]">My Discount</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Coupons</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Sell on Kaalis</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Help & Support</a>
            </div>
        </div>

        <!-- Main navbar -->
        <div class="flex items-center justify-between w-full px-4 pt-3 lg:py-3 md:px-6 lg:px-8">
            <!-- Hamburger menu (mobile only) -->
            <button @click="toggleMenu" class="lg:hidden text-[#363636]">
                <Menu class="w-6 h-6" />
            </button>

            <!-- Logo -->
            <div class="text-center lg:text-left flex-shrink-0">
                <router-link to="/" class="inline-block">
                    <p class="text-[#272425] text-xl pl-2 sm:text-3xl font-semibold">Bruthol</p>
                </router-link>
            </div>

            <!-- Search Bar -->
            <div class="hidden lg:block flex-1 mx-4 max-w-2xl">
                <div class="relative flex items-center">
                    <Search class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                    <input type="text" placeholder="Write the product, category or brand you are looking for"
                        class="w-full text-[#363636] bg-[#f3f3f3] pl-10 pr-4 py-2 rounded-l-full focus:outline-none focus:ring-1 focus:ring-[#ff2f62] focus:border-transparent" />
                    <button
                        class="bg-gradient-to-t from-[#ff934b] to-[#ff5e62] hover:from-[#ff5e62] hover:to-[#ff934b] text-white font-light py-2 px-4 rounded-r-full focus:outline-none transition duration-300 ease-in-out">
                        Search
                    </button>
                </div>
            </div>

            <!-- User Links -->
            <div class="w-full sm:w-auto flex justify-end sm:justify-end items-center space-x-4">
                <DropdownMenu>
                    <DropdownMenuTrigger as-child>
                        <Button variant="outline"
                            class="flex items-center text-[#363636] hover:text-[#ff5e62] transition duration-300">
                            <UserRound class="hover:fill-[#ff5e62] w-5 h-5" />
                            <span class="text-xs font-medium ml-1 hidden lg:inline">{{ isLoggedIn ? `Hi
                                ${user.username}` : 'Login' }}</span>
                        </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent class="w-56">
                        <DropdownMenuLabel>
                            <div class="flex items-center justify-between bg-[#24a3b5] py-3 px-4 rounded-t-sm">
                                <div class="flex items-center gap-5">
                                    <div class="bg-white rounded-full w-10 h-10 flex items-center justify-center">
                                        <CircleUserRound class="text-[#24a3b5] w-7 h-7 rounded-full text-gray-200" />
                                        <img src="../assets/images/Kyrian.png" alt="profile"
                                            class="hidden w-10 h-10 rounded-full cursor-pointer">
                                    </div>
                                    <div>
                                        <DropdownMenuItem v-if="!isLoggedIn"
                                            class="text-xs hover:text-[#363636] font-medium px-2 py-0">
                                            <router-link to="/login" class="text-white py-1 hover:text-[#24a3b5]">
                                                Login/Register
                                            </router-link>
                                        </DropdownMenuItem>
                                        <DropdownMenuItem v-else
                                            class="text-xs hover:text-[#363636] font-medium py-0 hover:text-[#24a3b5]">
                                            <router-link to="/orders" class="text-white py-1 hover:text-[#24a3b5]">
                                                {{ user.username }}
                                            </router-link>
                                        </DropdownMenuItem>
                                    </div>
                                </div>
                            </div>
                        </DropdownMenuLabel>
                        <DropdownMenuSeparator />
                        <DropdownMenuGroup v-if="isLoggedIn">
                            <DropdownMenuItem class="flex flex-col items-start space-y-1">
                                <span v-for="item in menuItems" :key="item.label" class="w-full p-1">
                                    <router-link active-class="active-link" :to="item.link"
                                        class="flex items-center text-gray-700 hover:text-[#24a3b5] transition-colors duration-300">
                                        <component :is="item.icon" class="w-5 h-5 mr-2 flex-shrink-0" />
                                        <span class="text-xs whitespace-nowrap">{{ item.label }}</span>
                                    </router-link>
                                </span>
                            </DropdownMenuItem>
                        </DropdownMenuGroup>
                        <DropdownMenuSeparator />
                        <div v-if="isLoggedIn">
                            <DropdownMenuItem @click="logout">
                                <span>Log out</span>
                            </DropdownMenuItem>
                        </div>
                    </DropdownMenuContent>
                </DropdownMenu>
                <button class="text-[#363636] hover:text-[#ff5e62] transition duration-300">
                    <Heart class="hover:fill-[#ff5e62] w-5 h-5" />
                </button>
                <button @click="navigateToCart"
                    class="text-[#363636] hover:text-[#ff5e62] transition duration-300 relative">
                    <ShoppingCart class="hover:fill-[#ff5e62] w-5 h-5" />
                    <span v-if="cartCount > 0"
                        class="absolute -top-2 -right-2 bg-[#ff5e62] text-white rounded-full text-xs w-5 h-5 flex items-center justify-center">
                        {{ cartCount }}
                    </span>
                </button>
            </div>
        </div>

        <!-- Categories nav -->
        <nav class="flex bg-white py-2 overflow-x-auto border-t border-b border-gray-200">
            <!-- Root categories -->
            <div class="hidden lg:flex flex-col items-start px-4 border-r border-gray-200">
                <button v-for="category in rootCategories" :key="category._id" @mouseenter="showSubcategories(category)"
                    class="text-left w-full py-2 px-4 hover:bg-gray-100 focus:outline-none">
                    {{ category.name }}
                </button>
            </div>

            <!-- Subcategories -->
            <div v-if="selectedCategory" class="flex-grow px-4">
                <div v-for="subcategory in selectedCategory.children" :key="subcategory._id" class="mb-4">
                    <h3 class="font-semibold mb-2">{{ subcategory.name }}</h3>
                    <ul class="grid grid-cols-4 gap-2">
                        <li v-for="item in subcategory.children" :key="item._id">
                            <router-link :to="`/category/${item.slug}`"
                                class="text-sm text-gray-600 hover:text-gray-900">
                                {{ item.name }}
                            </router-link>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Categories dropdown (mobile) -->
            <div class="lg:hidden relative">
                <button @click="toggleCategoryMenu"
                    class="flex items-center space-x-2 text-gray-700 hover:text-gray-900">
                    <Menu class="w-6 h-6" />
                    <span class="font-medium text-xs">ALL CATEGORIES</span>
                    <ChevronDown class="w-4 h-4" :class="{ 'transform rotate-180': isCategoryMenuOpen }" />
                </button>
                <div v-if="isCategoryMenuOpen" class="absolute top-full left-0 w-64 bg-white shadow-lg z-50 mt-1">
                    <ul class="py-2">
                        <li v-for="category in rootCategories" :key="category._id" class="px-4 py-2 hover:bg-gray-100">
                            <router-link :to="`/category/${category.slug}`"
                                class="block text-xs text-gray-700 hover:text-gray-900">
                                {{ category.name }}
                            </router-link>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>


        <!-- Search Bar (mobile) -->
        <div class="lg:hidden mx-4 my-2">
            <div class="relative flex items-center">
                <Search class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                <input type="text" placeholder="What is on your mind today?"
                    class="w-full text-[#363636] bg-[#f3f3f3] pl-10 pr-4 py-2 rounded-sm focus:outline-none focus:ring-1 focus:ring-[#ff2f62] focus:border-transparent" />
            </div>
        </div>

        <!-- Mobile menu (slides from left) -->
        <transition name="slide">
            <div v-if="isMenuOpen" class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg z-50 lg:hidden overflow-y-auto"
                v-click-outside="handleClickOutside">
                <div class="flex justify-end p-4">
                    <button @click="toggleMenu" class="text-[#363636]">
                        <X class="w-6 h-6" />
                    </button>
                </div>
                <nav class="px-4">
                    <!-- Categories -->
                    <h3 class="font-semibold text-lg mb-2">Categories</h3>
                    <ul class="space-y-2 mb-6">
                        <li v-for="category in mainCategories" :key="category._id">
                            <router-link :to="`/category/${category.slug}`" @click="closeMenu"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <span>{{ category.name }}</span>
                            </router-link>
                        </li>
                    </ul>

                    <!-- Menu Items -->
                    <h3 class="font-semibold text-lg mb-2">Menu</h3>
                    <ul class="space-y-2">
                        <li v-for="item in menuItems" :key="item.label">
                            <router-link :to="item.link"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <i :class="[item.icon, 'w-5 h-5 mr-2']"></i>
                                <span>{{ item.label }}</span>
                            </router-link>
                        </li>
                    </ul>
                </nav>
            </div>
        </transition>
    </header>
</template>

<script>
import {
    Popover,
    PopoverContent,
    PopoverTrigger,
} from '@/components/ui/popover'
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuGroup,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuPortal,
    DropdownMenuSeparator,
    DropdownMenuShortcut,
    DropdownMenuSub,
    DropdownMenuSubContent,
    DropdownMenuSubTrigger,
    DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { Label } from '@/components/ui/label'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import {
    UserRound, CircleUserRound, Heart, ShoppingCart, Search, ChevronRight, Menu, X, PackageOpen,
    Wallet,
    User,
    Box,
    Star,
    Store,
    HelpCircle,
    ChevronDown
} from 'lucide-vue-next';

import { menuItems } from '../utils/menuItems.js';
import { useUserStore } from '../store/user';
import { useCartStore } from '../store/cart';
import { toast } from 'vue-sonner';
import { useProductStore } from '../store/productStore.js';
import { storeToRefs } from 'pinia';
import { computed, onMounted, onUnmounted, ref } from 'vue';
import { useRouter } from 'vue-router';
import { clickOutside } from '../utils/clickOutside.js';

export default {
    name: 'Navbar',
    components: {
        Input,
        Label,
        Popover,
        PopoverContent,
        PopoverTrigger,
        UserRound,
        CircleUserRound,
        Heart,
        ShoppingCart,
        Search,
        ChevronRight,
        PackageOpen,
        Wallet,
        User,
        Box,
        Star,
        Store,
        HelpCircle,
        ChevronDown,
        Button,
        DropdownMenu,
        DropdownMenuContent,
        DropdownMenuGroup,
        DropdownMenuItem,
        DropdownMenuLabel,
        DropdownMenuPortal,
        DropdownMenuSeparator,
        DropdownMenuShortcut,
        DropdownMenuSub,
        DropdownMenuSubContent,
        DropdownMenuSubTrigger,
        DropdownMenuTrigger,
        Menu,
        X,
    },

    props: {
        isMenuOpen: Boolean
    },

    emits: ['toggleSidebar', 'closeMenu'],

    directives: {
        clickOutside
    },

    setup(props, { emit }) {
        const userStore = useUserStore();
        const cartStore = useCartStore();
        const router = useRouter();

        const isLoggedIn = computed(() => userStore.isLoggedIn);
        const user = computed(() => userStore.user || { username: 'Guest' });
        const cartCount = computed(() => cartStore.cartCount);

        const productStore = useProductStore();
        const { categories } = storeToRefs(productStore);

        console.log('categories: ', categories)

        const mainCategories = computed(() => {
            return categories.value ? categories.value.filter(category => !category.parent) : [];
        });

        const isLoading = ref(true);

        const rootCategories = computed(() => {
            return categories.value ? categories.value.filter(category => !category.parent) : [];
        });

        const isCategoryMenuOpen = ref(false);

        const selectedCategory = ref(null);

        const toggleCategoryMenu = () => {
            event.stopPropagation(); // Prevent the click from propagating to the document
            isCategoryMenuOpen.value = !isCategoryMenuOpen.value;
        };

        const showSubcategories = (category) => {
            selectedCategory.value = category;
        };

        const closeCategoryMenu = () => {
            isCategoryMenuOpen.value = false;
        };

        onMounted(async () => {
            if (categories.value.length === 0) {
                await productStore.fetchCategories();
            }
        });

        onMounted(async () => {
            if (userStore.isLoggedIn) {
                try {
                    await cartStore.fetchCart();
                    await productStore.fetchCategories();
                } catch (error) {
                    console.error('Failed to fetch data:', error);
                    if (error.response && error.response.status === 401) {
                        handleUnauthorized();
                    }
                } finally {
                    isLoading.value = false;
                }
            } else {
                try {
                    await productStore.fetchPublicCategories();
                } catch (error) {
                    console.error('Failed to fetch public categories:', error);
                } finally {
                    isLoading.value = false;
                }
            }

            document.addEventListener('click', handleClickOutside);
        });

        onUnmounted(() => {
            document.removeEventListener('click', handleClickOutside);
        });

        const handleUnauthorized = () => {
            userStore.clearUser();
            cartStore.$reset();
            productStore.$reset();
            router.push('/login');
        };


        const logout = () => {
            userStore.clearUser(); // This should remove the token
            cartStore.$reset(); // Reset cart state
            productStore.$reset(); // Reset product state
            router.push('/');
            toast.success("Logged Out Successfully");
        };

        const toggleMenu = (event) => {
            event.stopPropagation();
            emit('toggleSidebar');
        };

        const closeMenu = () => {
            console.log('Closing menu');  // Add this line for debugging
            emit('closeMenu');
        };

        // Close category menu when clicking outside
        const handleClickOutside = (event) => {
            setTimeout(closeMenu, 0);

            if (isCategoryMenuOpen.value && !event.target.closest('.category-menu')) {
                // isCategoryMenuOpen.value = false;
                closeCategoryMenu();
            }

            // Only close the mobile menu if it's open (you might need to add a prop or ref for this)
            if (props.isMenuOpen && !event.target.closest('.mobile-menu')) {
                closeMenu();
            }
        };

        const navigateToCart = () => {
            router.push({ name: 'Cart' });
        };

        return {
            isLoggedIn,
            user,
            logout,
            toggleMenu,
            closeMenu,
            menuItems,
            handleClickOutside,
            cartCount,
            navigateToCart,
            mainCategories,
            isLoading,
            categories,
            isCategoryMenuOpen,
            toggleCategoryMenu,
            selectedCategory,
            showSubcategories,
            rootCategories
        };
    }
}
</script>

<style scoped>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: #f7f7f7;
}

@media (max-width: 640px) {
    .w-full>* {
        margin-bottom: 0.5rem;
    }
}

.button-hover {
    transition: all 0.3s ease;
}

.button-hover:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.active-link {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    background-color: #24a3b5;
    color: white !important;
    display: block;
    width: 100%;
    padding: 4px;
    border-radius: 4px;
    margin-top: -10px;
}

.active-link>*,
.router-link-active>* {
    flex-shrink: 0;
}

.slide-enter-active,
.slide-leave-active {
    transition: transform 0.5s ease-in-out;
}

.slide-enter-from,
.slide-leave-to {
    transform: translateX(-100%);
}

.slide-enter-to,
.slide-leave-from {
    transform: translateX(0);
}

/* Smooth scrolling for category nav */
.overflow-x-auto {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

/* Hide scrollbar for Chrome, Safari and Opera */
.overflow-x-auto::-webkit-scrollbar {
    display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
.overflow-x-auto {
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
}

.category-menu {
    position: relative;
}

.category-menu-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 50;
    background-color: white;
    border: 1px solid #e2e8f0;
    border-radius: 0.375rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}
</style>












======================================Updated with All Categories version 4============================================
<template>
    <header class="flex flex-col w-full bg-white shadow-md lg:sticky -top-24 z-50">
        <!-- Top bar -->
        <div class="hidden lg:block w-full py-2 bg-gray-100">
            <div class="flex justify-end max-w-7xl mx-auto px-4 text-gray-500 text-xs space-x-2 md:space-x-4">
                <a href="#" class="hover:text-gray-700 text-[#374141]">My Discount</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Coupons</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Sell on Kaalis</a>
                <span class="hidden sm:inline">|</span>
                <a href="#" class="hover:text-gray-700 text-[#374141]">Help & Support</a>
            </div>
        </div>

        <!-- Main navbar -->
        <div class="flex items-center justify-between w-full px-4 pt-3 lg:py-3 md:px-6 lg:px-8">
            <!-- Hamburger menu (mobile only) -->
            <button @click="toggleMenu" class="lg:hidden text-[#363636]">
                <Menu class="w-6 h-6" />
            </button>

            <!-- Logo -->
            <div class="text-center lg:text-left flex-shrink-0">
                <router-link to="/" class="inline-block">
                    <p class="text-[#272425] text-xl pl-2 sm:text-3xl font-semibold">Bruthol</p>
                </router-link>
            </div>

            <!-- Search Bar -->
            <div class="hidden lg:block flex-1 mx-4 max-w-2xl">
                <div class="relative flex items-center">
                    <Search class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                    <input type="text" placeholder="Write the product, category or brand you are looking for"
                        class="w-full text-[#363636] bg-[#f3f3f3] pl-10 pr-4 py-2 rounded-l-full focus:outline-none focus:ring-1 focus:ring-[#ff2f62] focus:border-transparent" />
                    <button
                        class="bg-gradient-to-t from-[#ff934b] to-[#ff5e62] hover:from-[#ff5e62] hover:to-[#ff934b] text-white font-light py-2 px-4 rounded-r-full focus:outline-none transition duration-300 ease-in-out">
                        Search
                    </button>
                </div>
            </div>

            <!-- User Links -->
            <div class="w-full sm:w-auto flex justify-end sm:justify-end items-center space-x-4">
                <DropdownMenu>
                    <DropdownMenuTrigger as-child>
                        <Button variant="outline"
                            class="flex items-center text-[#363636] hover:text-[#ff5e62] transition duration-300">
                            <UserRound class="hover:fill-[#ff5e62] w-5 h-5" />
                            <span class="text-xs font-medium ml-1 hidden lg:inline">{{ isLoggedIn ? `Hi
                                ${user.username}` : 'Login' }}</span>
                        </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent class="w-56">
                        <DropdownMenuLabel>
                            <div class="flex items-center justify-between bg-[#24a3b5] py-3 px-4 rounded-t-sm">
                                <div class="flex items-center gap-5">
                                    <div class="bg-white rounded-full w-10 h-10 flex items-center justify-center">
                                        <CircleUserRound class="text-[#24a3b5] w-7 h-7 rounded-full text-gray-200" />
                                        <img src="../assets/images/Kyrian.png" alt="profile"
                                            class="hidden w-10 h-10 rounded-full cursor-pointer">
                                    </div>
                                    <div>
                                        <DropdownMenuItem v-if="!isLoggedIn"
                                            class="text-xs hover:text-[#363636] font-medium px-2 py-0">
                                            <router-link to="/login" class="text-white py-1 hover:text-[#24a3b5]">
                                                Login/Register
                                            </router-link>
                                        </DropdownMenuItem>
                                        <DropdownMenuItem v-else
                                            class="text-xs hover:text-[#363636] font-medium py-0 hover:text-[#24a3b5]">
                                            <router-link to="/orders" class="text-white py-1 hover:text-[#24a3b5]">
                                                {{ user.username }}
                                            </router-link>
                                        </DropdownMenuItem>
                                    </div>
                                </div>
                            </div>
                        </DropdownMenuLabel>
                        <DropdownMenuSeparator />
                        <DropdownMenuGroup v-if="isLoggedIn">
                            <DropdownMenuItem class="flex flex-col items-start space-y-1">
                                <span v-for="item in menuItems" :key="item.label" class="w-full p-1">
                                    <router-link active-class="active-link" :to="item.link"
                                        class="flex items-center text-gray-700 hover:text-[#24a3b5] transition-colors duration-300">
                                        <component :is="item.icon" class="w-5 h-5 mr-2 flex-shrink-0" />
                                        <span class="text-xs whitespace-nowrap">{{ item.label }}</span>
                                    </router-link>
                                </span>
                            </DropdownMenuItem>
                        </DropdownMenuGroup>
                        <DropdownMenuSeparator />
                        <div v-if="isLoggedIn">
                            <DropdownMenuItem @click="logout">
                                <span>Log out</span>
                            </DropdownMenuItem>
                        </div>
                    </DropdownMenuContent>
                </DropdownMenu>
                <button class="text-[#363636] hover:text-[#ff5e62] transition duration-300">
                    <Heart class="hover:fill-[#ff5e62] w-5 h-5" />
                </button>
                <button @click="navigateToCart"
                    class="text-[#363636] hover:text-[#ff5e62] transition duration-300 relative">
                    <ShoppingCart class="hover:fill-[#ff5e62] w-5 h-5" />
                    <span v-if="cartCount > 0"
                        class="absolute -top-2 -right-2 bg-[#ff5e62] text-white rounded-full text-xs w-5 h-5 flex items-center justify-center">
                        {{ cartCount }}
                    </span>
                </button>
            </div>
        </div>

        <!-- Categories nav -->
        <nav class="mx-auto w-11/12 py-2 bg-white border-t border-b border-gray-200">
            <!-- Horizontal category list -->
            <div class="flex items-center mb-2 overflow-x-auto category-menu">
                <button @click="toggleCategoryMenu"
                    class="flex items-center space-x-2 text-gray-700 hover:text-gray-900 mr-4">
                    <Menu class="w-6 h-6" />
                    <span class="font-medium text-xs">ALL CATEGORIES</span>
                    <ChevronDown class="w-4 h-4" :class="{ 'transform rotate-180': isCategoryMenuOpen }" />
                </button>
                <router-link v-for="category in rootCategories.slice(0, 10)" :key="category._id"
                    :to="`/category/${category.slug}`" class="text-sm whitespace-nowrap px-3 py-2 hover:text-[#f27a1a]"
                    @mouseover="hideSubcategories">
                    {{ category.name }}
                </router-link>
            </div>

            <!-- Category dropdown menu -->
            <div v-if="isCategoryMenuOpen" class="absolute left-0 w-full bg-white shadow-lg z-50 mt-1">
                <div class="flex mx-auto w-11/12">
                    <!-- Root categories -->
                    <div class="flex flex-col items-start bg-white px-4 border-r border-gray-200 w-52">
                        <button v-for="category in rootCategories" :key="category._id"
                            @mouseenter="showSubcategories(category)"
                            class="text-left w-full py-2 px-4 hover:bg-gray-100 focus:outline-none transition duration-150 ease-in-out">
                            {{ category.name }}
                        </button>
                    </div>

                    <!-- Subcategories -->
                    <div v-if="selectedCategory" class="flex-grow px-4 py-2 bg-white overflow-y-auto"
                        style="max-height: 80vh;">
                        <div class="flex flex-wrap">
                            <div v-for="(subcategory, index) in selectedCategory.children" :key="subcategory._id"
                                class="w-1/6 mb-4 pr-4">
                                <h3 class="font-semibold mb-2 text-[#f27a1a] text-sm">{{ subcategory.name }}</h3>
                                <ul class="space-y-1">
                                    <li v-for="item in subcategory.children" :key="item._id">
                                        <router-link :to="`/category/${item.slug}`"
                                            class="text-xs text-gray-600 hover:text-[#f27a1a] transition duration-150 ease-in-out">
                                            {{ item.name }}
                                        </router-link>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>


        <!-- Search Bar (mobile) -->
        <div class="lg:hidden mx-4 my-2">
            <div class="relative flex items-center">
                <Search class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-5 h-5" />
                <input type="text" placeholder="What is on your mind today?"
                    class="w-full text-[#363636] bg-[#f3f3f3] pl-10 pr-4 py-2 rounded-sm focus:outline-none focus:ring-1 focus:ring-[#ff2f62] focus:border-transparent" />
            </div>
        </div>

        <!-- Mobile menu (slides from left) -->
        <transition name="slide">
            <div v-if="isMenuOpen" class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg z-50 lg:hidden overflow-y-auto"
                v-click-outside="handleClickOutside">
                <div class="flex justify-end p-4">
                    <button @click="toggleMenu" class="text-[#363636]">
                        <X class="w-6 h-6" />
                    </button>
                </div>
                <nav class="px-4">
                    <!-- Categories -->
                    <h3 class="font-semibold text-lg mb-2">Categories</h3>
                    <ul class="space-y-2 mb-6">
                        <li v-for="category in mainCategories" :key="category._id">
                            <router-link :to="`/category/${category.slug}`" @click="closeMenu"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <span>{{ category.name }}</span>
                            </router-link>
                        </li>
                    </ul>

                    <!-- Menu Items -->
                    <h3 class="font-semibold text-lg mb-2">Menu</h3>
                    <ul class="space-y-2">
                        <li v-for="item in menuItems" :key="item.label">
                            <router-link :to="item.link"
                                class="flex items-center text-[#363636] hover:text-[#ff5e62] py-2">
                                <i :class="[item.icon, 'w-5 h-5 mr-2']"></i>
                                <span>{{ item.label }}</span>
                            </router-link>
                        </li>
                    </ul>
                </nav>
            </div>
        </transition>
    </header>
</template>

<script>
import {
    Popover,
    PopoverContent,
    PopoverTrigger,
} from '@/components/ui/popover'
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuGroup,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuPortal,
    DropdownMenuSeparator,
    DropdownMenuShortcut,
    DropdownMenuSub,
    DropdownMenuSubContent,
    DropdownMenuSubTrigger,
    DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { Label } from '@/components/ui/label'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import {
    UserRound, CircleUserRound, Heart, ShoppingCart, Search, ChevronRight, Menu, X, PackageOpen,
    Wallet,
    User,
    Box,
    Star,
    Store,
    HelpCircle,
    ChevronDown
} from 'lucide-vue-next';

import { menuItems } from '../utils/menuItems.js';
import { useUserStore } from '../store/user';
import { useCartStore } from '../store/cart';
import { toast } from 'vue-sonner';
import { useProductStore } from '../store/productStore.js';
import { storeToRefs } from 'pinia';
import { computed, onMounted, onUnmounted, ref } from 'vue';
import { useRouter } from 'vue-router';
import { clickOutside } from '../utils/clickOutside.js';

export default {
    name: 'Navbar',
    components: {
        Input,
        Label,
        Popover,
        PopoverContent,
        PopoverTrigger,
        UserRound,
        CircleUserRound,
        Heart,
        ShoppingCart,
        Search,
        ChevronRight,
        PackageOpen,
        Wallet,
        User,
        Box,
        Star,
        Store,
        HelpCircle,
        ChevronDown,
        Button,
        DropdownMenu,
        DropdownMenuContent,
        DropdownMenuGroup,
        DropdownMenuItem,
        DropdownMenuLabel,
        DropdownMenuPortal,
        DropdownMenuSeparator,
        DropdownMenuShortcut,
        DropdownMenuSub,
        DropdownMenuSubContent,
        DropdownMenuSubTrigger,
        DropdownMenuTrigger,
        Menu,
        X,
    },

    props: {
        isMenuOpen: Boolean
    },

    emits: ['toggleSidebar', 'closeMenu'],

    directives: {
        clickOutside
    },

    setup(props, { emit }) {
        const userStore = useUserStore();
        const cartStore = useCartStore();
        const router = useRouter();

        const isLoggedIn = computed(() => userStore.isLoggedIn);
        const user = computed(() => userStore.user || { username: 'Guest' });
        const cartCount = computed(() => cartStore.cartCount);

        const productStore = useProductStore();
        const { categories } = storeToRefs(productStore);

        console.log('categories: ', categories)

        const mainCategories = computed(() => {
            return categories.value ? categories.value.filter(category => !category.parent) : [];
        });

        const isLoading = ref(true);

        const rootCategories = computed(() => {
            return categories.value ? categories.value.filter(category => !category.parent) : [];
        });

        const isCategoryMenuOpen = ref(false);
        const selectedCategory = ref(null);
        let closeTimeout = null;

        const toggleCategoryMenu = () => {
            isCategoryMenuOpen.value = !isCategoryMenuOpen.value;
            if (isCategoryMenuOpen.value && rootCategories.value.length > 0) {
                showSubcategories(rootCategories.value[11]); //default category
            }
        };

        const showSubcategories = (category) => {
            selectedCategory.value = category;
            isCategoryMenuOpen.value = true;
            cancelHideSubcategories();
        };


        const hideSubcategories = () => {
            closeTimeout = setTimeout(() => {
                isCategoryMenuOpen.value = false;
                selectedCategory.value = null; // Reset selected category
            }, 300); // 300ms delay before closing
        };

        const cancelHideSubcategories = () => {
            if (closeTimeout) {
                clearTimeout(closeTimeout);
                closeTimeout = null;
            }
        };

        const closeCategoryMenu = () => {
            isCategoryMenuOpen.value = false;
        };

        onMounted(async () => {
            if (categories.value.length === 0) {
                await productStore.fetchCategories();
            }
        });

        onMounted(async () => {
            if (userStore.isLoggedIn) {
                try {
                    await cartStore.fetchCart();
                    await productStore.fetchCategories();
                } catch (error) {
                    console.error('Failed to fetch data:', error);
                    if (error.response && error.response.status === 401) {
                        handleUnauthorized();
                    }
                } finally {
                    isLoading.value = false;
                }
            } else {
                try {
                    await productStore.fetchPublicCategories();
                } catch (error) {
                    console.error('Failed to fetch public categories:', error);
                } finally {
                    isLoading.value = false;
                }
            }

            document.addEventListener('click', handleClickOutside);
        });

        onUnmounted(() => {
            document.removeEventListener('click', handleClickOutside);
        });

        const handleUnauthorized = () => {
            userStore.clearUser();
            cartStore.$reset();
            productStore.$reset();
            router.push('/login');
        };


        const logout = () => {
            userStore.clearUser(); // This should remove the token
            cartStore.$reset(); // Reset cart state
            productStore.$reset(); // Reset product state
            router.push('/');
            toast.success("Logged Out Successfully");
        };

        const toggleMenu = (event) => {
            event.stopPropagation();
            emit('toggleSidebar');
        };

        const closeMenu = () => {
            console.log('Closing menu');  // Add this line for debugging
            emit('closeMenu');
        };

        // Close category menu when clicking outside or hovering horizontal categories
        const handleClickOutside = (event) => {
            // setTimeout(closeMenu, 0);  check on my later

            const categoryMenu = document.querySelector('.category-menu');
            const dropdownMenu = document.querySelector('.category-dropdown');

            if (!categoryMenu?.contains(event.target) && !dropdownMenu?.contains(event.target)) {
                hideSubcategories();
            }

            // Only close the mobile menu if it's open (you might need to add a prop or ref for this)
            if (props.isMenuOpen && !event.target.closest('.mobile-menu')) {
                closeMenu();
            }
        };

        onMounted(() => {
            document.addEventListener('click', handleClickOutside);
        });

        onUnmounted(() => {
            document.removeEventListener('click', handleClickOutside);
            if (closeTimeout) {
                clearTimeout(closeTimeout);
            }
        });

        const navigateToCart = () => {
            router.push({ name: 'Cart' });
        };

        return {
            isLoggedIn,
            user,
            logout,
            toggleMenu,
            closeMenu,
            menuItems,
            handleClickOutside,
            cartCount,
            navigateToCart,
            mainCategories,
            isLoading,
            categories,
            isCategoryMenuOpen,
            toggleCategoryMenu,
            selectedCategory,
            showSubcategories,
            rootCategories,
            hideSubcategories,
            cancelHideSubcategories
        };
    }
}
</script>

<style scoped>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: #f7f7f7;
}

@media (max-width: 640px) {
    .w-full>* {
        margin-bottom: 0.5rem;
    }
}

.button-hover {
    transition: all 0.3s ease;
}

.button-hover:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.active-link {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    background-color: #24a3b5;
    color: white !important;
    display: block;
    width: 100%;
    padding: 4px;
    border-radius: 4px;
    margin-top: -10px;
}

.active-link>*,
.router-link-active>* {
    flex-shrink: 0;
}

.slide-enter-active,
.slide-leave-active {
    transition: transform 0.5s ease-in-out;
}

.slide-enter-from,
.slide-leave-to {
    transform: translateX(-100%);
}

.slide-enter-to,
.slide-leave-from {
    transform: translateX(0);
}

/* Smooth scrolling for category nav */
.overflow-x-auto {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

/* Hide scrollbar for Chrome, Safari and Opera */
.overflow-x-auto::-webkit-scrollbar {
    display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
.overflow-x-auto {
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
}

.category-menu {
    position: relative;
}

.category-menu-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 50;
    background-color: white;
    border: 1px solid #e2e8f0;
    border-radius: 0.375rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}
</style>